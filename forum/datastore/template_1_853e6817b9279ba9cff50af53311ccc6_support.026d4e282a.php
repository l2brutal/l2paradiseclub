<?php

return <<<'VALUE'
"namespace IPS\\Theme;\nclass class_nexus_admin_support extends \\IPS\\Theme\\Template\n{\n\tpublic $cache_key = 'd1b5490a77d02de1ac2056265b4ddaaf';\n\tfunction department( $department ) {\n\t\t$return = '';\n\t\t$return .= <<<CONTENT\n\n\nCONTENT;\n$return .= htmlspecialchars( $department->_title, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\nCONTENT;\n\n\t\treturn $return;\n}\n\n\tfunction feedback( $rating ) {\n\t\t$return = '';\n\t\t$return .= <<<CONTENT\n\n<div class=\"ipsPad\">\n\t<ul class='ipsList_inline ipsClearfix ipsRating ipsRating_veryLarge'>\n\t\t\nCONTENT;\n\nforeach ( range( 1, 5 ) as $i ):\n$return .= <<<CONTENT\n\n\t\t\t<li class='\nCONTENT;\n\nif ( $rating['rating_rating'] >= $i ):\n$return .= <<<CONTENT\nipsRating_on\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n'><i class='fa fa-star'><\/i><\/li>\n\t\t\nCONTENT;\n\nendforeach;\n$return .= <<<CONTENT\n\n\t<\/ul>\n\t<hr class=\"ipsHr\">\n\t\nCONTENT;\n\n$return .= htmlspecialchars( nl2br( $rating['rating_note'] ), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\n<\/div>\nCONTENT;\n\n\t\treturn $return;\n}\n\n\tfunction filterForm( $id, $action, $elements, $hiddenValues, $actionButtons, $uploadField, $class='', $attributes=array(), $sidebar, $form=NULL ) {\n\t\t$return = '';\n\t\t$return .= <<<CONTENT\n\n<form accept-charset='utf-8' class=\"ipsForm ipsForm_fullWidth \nCONTENT;\n$return .= htmlspecialchars( $class, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\" action=\"\nCONTENT;\n$return .= htmlspecialchars( $action, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\" method=\"post\" \nCONTENT;\n\nif ( $uploadField ):\n$return .= <<<CONTENT\nenctype=\"multipart\/form-data\"\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n \nCONTENT;\n\nforeach ( $attributes as $k => $v ):\n$return .= <<<CONTENT\n\nCONTENT;\n$return .= htmlspecialchars( $k, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n=\"\nCONTENT;\n$return .= htmlspecialchars( $v, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\"\nCONTENT;\n\nendforeach;\n$return .= <<<CONTENT\n data-ipsForm>\n\t<input type=\"hidden\" name=\"\nCONTENT;\n$return .= htmlspecialchars( $id, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n_submitted\" value=\"1\">\n\t\nCONTENT;\n\nforeach ( $hiddenValues as $k => $v ):\n$return .= <<<CONTENT\n\n\t\t\nCONTENT;\n\nif ( is_array($v) ):\n$return .= <<<CONTENT\n\n\t\t\t\nCONTENT;\n\nforeach ( $v as $_k => $_v ):\n$return .= <<<CONTENT\n\n\t\t\t\t<input type=\"hidden\" name=\"\nCONTENT;\n$return .= htmlspecialchars( $k, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n[\nCONTENT;\n$return .= htmlspecialchars( $_k, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n]\" value=\"\nCONTENT;\n$return .= htmlspecialchars( $_v, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\">\n\t\t\t\nCONTENT;\n\nendforeach;\n$return .= <<<CONTENT\n\n\t\t\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n\t\t\t<input type=\"hidden\" name=\"\nCONTENT;\n$return .= htmlspecialchars( $k, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\" value=\"\nCONTENT;\n$return .= htmlspecialchars( $v, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\">\n\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\nCONTENT;\n\nendforeach;\n$return .= <<<CONTENT\n\n\t\nCONTENT;\n\nif ( $uploadField ):\n$return .= <<<CONTENT\n\n\t\t<input type=\"hidden\" name=\"MAX_FILE_SIZE\" value=\"\nCONTENT;\n$return .= htmlspecialchars( $uploadField, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\">\n\t\t<input type=\"hidden\" name=\"plupload\" value=\"\nCONTENT;\n\n$return .= htmlspecialchars( md5( mt_rand() ), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\">\n\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\nCONTENT;\n\nforeach ( $elements['streams'] as $input ):\n$return .= <<<CONTENT\n\n\t\t<ul class='ipsList_reset'>\n\t\t\t{$input->html($form)}\n\t\t<\/ul>\n\t\nCONTENT;\n\nendforeach;\n$return .= <<<CONTENT\n\n\t<div id=\"elFilterFormFull\" class=\"ipsPad \nCONTENT;\n\nif ( isset( $elements['streams'] ) ):\n$return .= <<<CONTENT\nipsJS_hide\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\">\n\t\t<div class='ipsAreaBackground_light'>\n\t\t\t\nCONTENT;\n\nif ( isset( $elements['title'] ) ):\n$return .= <<<CONTENT\n\n\t\t\t\t\nCONTENT;\n\nforeach ( $elements['title'] as $input ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t<ul class='ipsList_reset ipsPad ipsAreaBackground cStreamForm_mainTitle ipsFieldRow_primary'>\n\t\t\t\t\t\t{$input->rowHtml($form)}\n\t\t\t\t\t<\/ul>\n\t\t\t\t\nCONTENT;\n\nendforeach;\n$return .= <<<CONTENT\n\n\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t<div class=\"ipsGrid ipsGrid_collapsePhone ipsPad ipsSpacer_bottom\">\n\t\t\t\t\nCONTENT;\n\nforeach ( $elements as $tabName => $collection ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\nCONTENT;\n\nif ( $tabName != 'streams' and $tabName != 'title' ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t<div class=\"ipsGrid_span4\">\n\t\t\t\t\t\t\t<ul class='ipsList_reset'>\n\t\t\t\t\t\t\t\t\nCONTENT;\n\nforeach ( $collection as $input ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nif ( $input instanceof \\IPS\\Helpers\\Form\\CheckboxSet ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t<li data-controller=\"nexus.admin.support.filterCheckboxSet\">\n\t\t\t\t\t\t\t\t\t\t\t<h3 class=\"ipsType_reset ipsType_large cStreamForm_title ipsSpacer_bottom ipsSpacer_half\">\n\t\t\t\t\t\t\t\t\t\t\t\t\nCONTENT;\n\n$val = \"{$input->name}\"; $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( $val, ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t<p class='ipsType_reset ipsSpacer_top ipsSpacer_half ipsType_small ipsPos_right'>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<a href=\"#all\" class=\"ipsJS_show\" data-action=\"checkAll\">\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'all', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a> &middot; <a href=\"#all\" class=\"ipsJS_show\" data-action=\"checkNone\">\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'none', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a>\n\t\t\t\t\t\t\t\t\t\t\t\t<\/p>\n\t\t\t\t\t\t\t\t\t\t\t<\/h3>\n\t\t\t\t\t\t\t\t\t\t\t<ul class=\"ipsSideMenu_list ipsSideMenu_withChecks ipsSideMenu_small ipsType_normal cNexusSupportCheckboxes\" data-role='searchApp' data-ipsSideMenu data-ipsSideMenu-type=\"check\" data-ipsSideMenu-responsive=\"false\">\n\t\t\t\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nforeach ( $input->options['options'] as $k => $lang ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<a href='#' id='elSearchToggle_\nCONTENT;\n$return .= htmlspecialchars( $k, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n' class='ipsSideMenu_item \nCONTENT;\n\nif ( is_array( $input->value ) AND in_array( $k, $input->value ) ):\n$return .= <<<CONTENT\nipsSideMenu_itemActive\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n' data-ipsMenuValue='\nCONTENT;\n$return .= htmlspecialchars( $k, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n'>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<input type=\"checkbox\" name=\"\nCONTENT;\n$return .= htmlspecialchars( $input->name, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n[\nCONTENT;\n$return .= htmlspecialchars( $k, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n]\" value=\"1\" \nCONTENT;\n\nif ( is_array( $input->value ) AND in_array( $k, $input->value ) ):\n$return .= <<<CONTENT\nchecked\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n id=\"elRadio_type_\nCONTENT;\n$return .= htmlspecialchars( $k, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\" \nCONTENT;\n\nif ( is_array( $input->options['toggles'] ) && count( $input->options['toggles'] ) ):\n$return .= <<<CONTENT\ndata-control=\"toggle\" data-toggles=\"\nCONTENT;\n\n$return .= htmlspecialchars( implode( ',', $input->options['toggles'][ $k ] ), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\" data-toggle-visibleCheck='#elSearchToggle_\nCONTENT;\n$return .= htmlspecialchars( $k, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n'\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<label for='elRadio_type_\nCONTENT;\n$return .= htmlspecialchars( $k, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n' id='elField_type_\nCONTENT;\n$return .= htmlspecialchars( $k, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n_label' data-role='searchAppTitle'>\nCONTENT;\n\n$val = \"{$lang}\"; $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( $val, ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/label>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<\/a>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<\/li>\n\t\t\t\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nendforeach;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t\t<\/ul>\n\t\t\t\t\t\t\t\t\t\t<\/li>\n\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nelseif ( is_object( $input )  ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t{$input->rowHtml($form)}\n\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t{$input}\n\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\nCONTENT;\n\nendforeach;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t<\/ul>\n\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\nCONTENT;\n\nendforeach;\n$return .= <<<CONTENT\n\n\t\t\t<\/div>\n\t\t\t<div class='ipsAreaBackground ipsPad ipsType_center'>\n\t\t\t\t\nCONTENT;\n\n$return .= implode( '', $actionButtons);\n$return .= <<<CONTENT\n\n\t\t\t<\/div>\n\t\t<\/div>\n\t<\/div>\n<\/form>\n<div class=\"ipsMenu ipsMenu_auto ipsMenu_withStem ipsHide\" id=\"elSaveStream_menu\">\n\t<form action=\"\nCONTENT;\n\n$return .= str_replace( '&', '&amp;', \\IPS\\Http\\Url::internal( \"app=nexus&module=support&controller=requests&do=saveStream\", null, \"\", array(), 0 ) );\n$return .= <<<CONTENT\n\" method=\"post\">\n\t\t<div class=\"ipsPad\">\n\t\t\t<input type=\"text\" name=\"stream_title\" placeholder=\"\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'stream_title', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\">\n\t\t<\/div>\n\t\t<div class=\"ipsAreaBackground ipsPad ipsType_center\">\n\t\t\t<input type=\"submit\" class=\"ipsButton ipsButton_fullWidth ipsButton_small ipsButton_primary\" value=\"\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'save', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\">\n\t\t<\/div>\n\t<\/form>\n<\/div>\nCONTENT;\n\n\t\treturn $return;\n}\n\n\tfunction filterFormStream( $input, $options ) {\n\t\t$return = '';\n\t\t$return .= <<<CONTENT\n\n<div class=\"ipsTabs ipsTabs_stretch ipsClearfix ipsJS_show acpFormTabBar cNexusStream_tabs\" id='elSupportTabs' data-ipsTabBar data-ipsTabBar-disableNav data-ipsTabBar-contentArea='#elRequestsTabContent'>\n\t<ul role=\"tablist\">\n\t\t<a href=\"#elSupportTabs\" data-action='expandTabs'><i class='fa fa-caret-down'><\/i><\/a>\n\t\t\nCONTENT;\n\nforeach ( $options as $stream ):\n$return .= <<<CONTENT\n\n\t\t\t<li class=\"cNexusStream\">\n\t\t\t\t<span class='ipsTabs_item \nCONTENT;\n\nif ( $input->value == $stream->id ):\n$return .= <<<CONTENT\nipsTabs_activeItem\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n'>\n\t\t\t\t\t<input type=\"radio\" name=\"stream\" value=\"\nCONTENT;\n$return .= htmlspecialchars( $stream->id, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\" id=\"elRadio_stream_\nCONTENT;\n$return .= htmlspecialchars( $stream->id, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\" \nCONTENT;\n\nif ( $input->value == $stream->id ):\n$return .= <<<CONTENT\nchecked\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n data-action=\"quickToggle\" data-url=\"\nCONTENT;\n\n$return .= str_replace( '&', '&amp;', \\IPS\\Http\\Url::internal( \"app=nexus&module=support&controller=requests&stream={$stream->id}\", null, \"\", array(), 0 ) );\n$return .= <<<CONTENT\n\">\n\t\t\t\t\t<span class='cNexusStream_count ipsCursor_pointer' data-action=\"quickToggleCount\">\nCONTENT;\n$return .= htmlspecialchars( $stream->count( \\IPS\\Member::loggedIn() ), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n<\/span>\n\t\t\t\t\t<label for='elRadio_stream_\nCONTENT;\n$return .= htmlspecialchars( $stream->id, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n' id='elRadio_stream_\nCONTENT;\n$return .= htmlspecialchars( $stream->id, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n_label' class=\"ipsCursor_pointer\">\n\t\t\t\t\t\t\nCONTENT;\n\nif ( $stream->temporary ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t<a class='ipsResponsive_hidePhone ipsButton ipsButton_veryVerySmall ipsButton_primary ipsPos_right ipsSpacer_top ipsSpacer_half' href=\"\nCONTENT;\n\n$return .= str_replace( '&', '&amp;', \\IPS\\Http\\Url::internal( \"app=nexus&module=support&controller=requests&do=saveStream&id={$stream->id}\", null, \"\", array(), 0 ) );\n$return .= <<<CONTENT\n\" data-ipsMenu id=\"elSaveStream\">\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'save', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a>\n\t\t\t\t\t\t\nCONTENT;\n\nelseif ( is_int( $stream->id ) ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t<a class='ipsResponsive_hidePhone ipsButton ipsButton_veryVerySmall ipsButton_veryLight ipsPos_right ipsSpacer_top ipsSpacer_half' href=\"\nCONTENT;\n\n$return .= str_replace( '&', '&amp;', \\IPS\\Http\\Url::internal( \"app=nexus&module=support&controller=requests&do=editStream&id={$stream->id}\", null, \"\", array(), 0 ) );\n$return .= <<<CONTENT\n\" data-action=\"editStream\">\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'edit', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n <i class='fa fa-angle-down'><\/i><\/a>\n\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\nCONTENT;\n$return .= htmlspecialchars( $stream->title, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\n\t\t\t\t\t<\/label>\n\t\t\t\t<\/span>\n\t\t\t<\/li>\n\t\t\nCONTENT;\n\nendforeach;\n$return .= <<<CONTENT\n\n\t\t<li class=\"cNexusStream\">\n\t\t\t<span class='ipsTabs_item \nCONTENT;\n\nif ( $input->value == 'custom' ):\n$return .= <<<CONTENT\nipsTabs_activeItem\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n'>\n\t\t\t\t<input type=\"radio\" name=\"stream\" value=\"custom\" id=\"elRadio_stream_custom\" data-control=\"toggle\" data-toggles=\"elFilterFormFull\" \nCONTENT;\n\nif ( $input->value == 'custom' ):\n$return .= <<<CONTENT\nchecked\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n data-action=\"quickToggle\">\n\t\t\t\t&nbsp;\n\t\t\t\t<label for='elRadio_stream_custom' id='elRadio_stream_custom_label' class=\"ipsCursor_pointer\">\n\t\t\t\t\t<i class='fa fa-plus'><\/i> \nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'support_stream_other', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\n\t\t\t\t<\/label>\n\t\t\t<\/span>\n\t\t<\/li>\n\t<\/ul>\n<\/div>\nCONTENT;\n\n\t\treturn $return;\n}\n\n\tfunction filterFormTime( $input ) {\n\t\t$return = '';\n\t\t$return .= <<<CONTENT\n\n<input\n\tname=\"\nCONTENT;\n$return .= htmlspecialchars( $input->name, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\"\n\ttype=\"number\"\n\t\nCONTENT;\n\nif ( $input->value === NULL ):\n$return .= <<<CONTENT\n\n\t\tvalue=\"\"\n\t\tdata-jsdisable=\"true\"\n\t\nCONTENT;\n\nelseif ( is_numeric( $input->value ) ):\n$return .= <<<CONTENT\n\n\t\tvalue=\"\nCONTENT;\n\n$return .= htmlspecialchars( number_format( $input->value, mb_strlen( mb_substr( $input->value, mb_strpos( $input->value, '.' ) + 1 ) ), '.', '' ), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\"\n\t\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n\t\tvalue=\"0\"\n\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\tclass=\"ipsField_tiny\"\n\tmin=\"0\"\n>\n\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'hours_ago', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\n&nbsp;\n<div class=\"ipsFieldRow_inlineCheckbox\">\n\t\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'or', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\n\t&nbsp;\n\t<span class='ipsCustomInput'>\n\t\t<input type=\"checkbox\" role='checkbox' data-control=\"unlimited\" name=\"\nCONTENT;\n$return .= htmlspecialchars( $input->name, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n_unlimited\" id='\nCONTENT;\n$return .= htmlspecialchars( $input->name, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n_unlimited_check' value=\"1\" \nCONTENT;\n\nif ( NULL === $input->value ):\n$return .= <<<CONTENT\nchecked aria-checked='true'\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n aria-labelledby='\nCONTENT;\n$return .= htmlspecialchars( $input->name, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n_unlimited_label'>\n\t\t<span><\/span>\n\t<\/span> <label for='\nCONTENT;\n$return .= htmlspecialchars( $input->name, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n_unlimited_check' id='\nCONTENT;\n$return .= htmlspecialchars( $input->name, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n_unlimited_label' class='ipsField_unlimited'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'support_stream_any_time', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/label>\n<\/div>\n\nCONTENT;\n\n\t\treturn $return;\n}\n\n\tfunction highlightSetting( $name, $stat, $number, $numberType ) {\n\t\t$return = '';\n\t\t$return .= <<<CONTENT\n\n<select name=\"\nCONTENT;\n$return .= htmlspecialchars( $name, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n[0]\">\n\t\nCONTENT;\n\nforeach ( array( 'r_started', 'r_last_reply', 'r_last_new_reply', 'r_last_staff_reply' ) as $k ):\n$return .= <<<CONTENT\n\n\t\t<option value=\"\nCONTENT;\n$return .= htmlspecialchars( $k, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\" \nCONTENT;\n\nif ( $stat === $k ):\n$return .= <<<CONTENT\nselected\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n>\nCONTENT;\n\n$val = \"{$k}\"; $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( $val, ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/option>\n\t\nCONTENT;\n\nendforeach;\n$return .= <<<CONTENT\n\n<\/select>\n<label>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'more_than', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/label>\n<input type=\"number\" name=\"\nCONTENT;\n$return .= htmlspecialchars( $name, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n[1]\" value=\"\nCONTENT;\n$return .= htmlspecialchars( $number, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\" class=\"ipsField_short\" \/>\n<select name=\"\nCONTENT;\n$return .= htmlspecialchars( $name, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n[2]\">\n\t\nCONTENT;\n\nforeach ( array( 'minutes', 'hours', 'days' ) as $k ):\n$return .= <<<CONTENT\n\n\t\t<option value=\"\nCONTENT;\n$return .= htmlspecialchars( $k, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\" \nCONTENT;\n\nif ( $numberType === $k ):\n$return .= <<<CONTENT\nselected\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n>\nCONTENT;\n\n$val = \"{$k}\"; $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( $val, ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/option>\n\t\nCONTENT;\n\nendforeach;\n$return .= <<<CONTENT\n\n<\/select>\n<label>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'ago', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/label>\n<br><br>\n\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'or', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n \n<span class='ipsCustomInput'>\n\t<input type=\"checkbox\" name=\"\nCONTENT;\n$return .= htmlspecialchars( $name, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n[3]\" \nCONTENT;\n\nif ( !$number ):\n$return .= <<<CONTENT\nchecked\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n data-control=\"unlimited\" id=\"\nCONTENT;\n$return .= htmlspecialchars( $name, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n_unlimited\">\n\t<span><\/span>\n<\/span> <label for=\"\nCONTENT;\n$return .= htmlspecialchars( $name, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n_unlimited\" class='ipsField_unlimited'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'do_not_highlight_requests', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/label>\nCONTENT;\n\n\t\treturn $return;\n}\n\n\tfunction latestFeedback( $table, $headers, $rows ) {\n\t\t$return = '';\n\t\t$return .= <<<CONTENT\n\n\nCONTENT;\n\nif ( $table->pages > 1 ):\n$return .= <<<CONTENT\n\n\t<div data-role=\"tablePagination\">\n\t\t\nCONTENT;\n\n$return .= \\IPS\\Theme::i()->getTemplate( \"global\", \"core\", 'global' )->pagination( $table->baseUrl, $table->pages, $table->page, $table->limit );\n$return .= <<<CONTENT\n\n\t<\/div>\n\t<br>\n\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\n<ul class='ipsDataList ipsDataList_large'>\n\t\nCONTENT;\n\nforeach ( $rows as $row ):\n$return .= <<<CONTENT\n\n\t\t<li class='ipsDataItem'>\n\t\t\t<div class='ipsDataItem_generic ipsDataItem_size4 ipsType_center ipsPos_top'>\n\t\t\t\t<ul class='ipsList_inline ipsClearfix ipsRating ipsRating_large'>\n\t\t\t\t\t\nCONTENT;\n\nforeach ( range( 1, 5 ) as $i ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t<li class='\nCONTENT;\n\nif ( $row['rating_rating'] >= $i ):\n$return .= <<<CONTENT\nipsRating_on\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n'><i class='fa fa-star'><\/i><\/li>\n\t\t\t\t\t\nCONTENT;\n\nendforeach;\n$return .= <<<CONTENT\n\n\t\t\t\t<\/ul>\n\t\t\t<\/div>\n\t\t\t<div class='ipsDataItem_main'>\n\t\t\t\t<h3 class='ipsType_reset ipsType_sectionHead'><span class='ipsType_light ipsType_unbold'>#\nCONTENT;\n$return .= htmlspecialchars( $row['r_id'], ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n<\/span> <a href=\"\nCONTENT;\n\n$return .= str_replace( '&', '&amp;', \\IPS\\Http\\Url::internal( \"app=nexus&module=support&controller=request&id={$row['r_id']}\", null, \"\", array(), 0 ) );\n$return .= <<<CONTENT\n\">\nCONTENT;\n$return .= htmlspecialchars( $row['r_title'], ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n<\/a><\/h3>\n\t\t\t\t<p class='ipsType_reset ipsType_normal ipsType_light'>\nCONTENT;\n\n$sprintf = array(\\IPS\\Member::load( $row['rating_from'] )->name, \\IPS\\Member::load( $row['reply_member'] )->name); $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'performance_rated_by', ENT_DISALLOWED, 'UTF-8', FALSE ), FALSE, array( 'sprintf' => $sprintf ) );\n$return .= <<<CONTENT\n<\/p>\n\t\t\t\t<p class='ipsType_reset ipsType_medium ipsSpacer_top ipsSpacer_half'>\n\t\t\t\t\t\nCONTENT;\n\nif ( $row['rating_note'] ):\n$return .= <<<CONTENT\n\nCONTENT;\n$return .= htmlspecialchars( $row['rating_note'], ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'no_feedback', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t<\/p>\n\t\t\t<\/div>\n\t\t<\/li>\n\t\nCONTENT;\n\nendforeach;\n$return .= <<<CONTENT\n\n<\/ul>\n\n\nCONTENT;\n\nif ( $table->pages > 1 ):\n$return .= <<<CONTENT\n\n\t<div data-role=\"tablePagination\">\n\t\t\nCONTENT;\n\n$return .= \\IPS\\Theme::i()->getTemplate( \"global\", \"core\", 'global' )->pagination( $table->baseUrl, $table->pages, $table->page, $table->limit );\n$return .= <<<CONTENT\n\n\t<\/div>\n\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\nCONTENT;\n\n\t\treturn $return;\n}\n\n\tfunction link( $request, $hovercard=TRUE ) {\n\t\t$return = '';\n\t\t$return .= <<<CONTENT\n\n<a href=\"\nCONTENT;\n$return .= htmlspecialchars( $request->acpUrl(), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\" \nCONTENT;\n\nif ( $hovercard ):\n$return .= <<<CONTENT\ndata-ipsHover data-ipsHover-target=\"\nCONTENT;\n$return .= htmlspecialchars( $request->acpUrl()->setQueryString( array( 'do' => 'hovercard' ) ), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\" data-ipsHover-width=\"750\"\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n data-role=\"supportLink\">\n\t\nCONTENT;\n\nif ( $request->unread() ):\n$return .= <<<CONTENT\n\n\t\t<strong>\nCONTENT;\n$return .= htmlspecialchars( $request->title, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n<\/strong>\n\t\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n\t\t\nCONTENT;\n$return .= htmlspecialchars( $request->title, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\n\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n<\/a>\n<span class='ipsType_light ipsType_medium'>#\nCONTENT;\n$return .= htmlspecialchars( $request->id, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n<\/span>\nCONTENT;\n\n\t\treturn $return;\n}\n\n\tfunction myDepartments( $id, $action, $elements, $hiddenValues, $actionButtons, $uploadField, $class='', $attributes=array(), $sidebar, $form=NULL ) {\n\t\t$return = '';\n\t\t$return .= <<<CONTENT\n\n<div class=\"ipsAreaBackground ipsPad\">\n\t<form accept-charset='utf-8' action=\"\nCONTENT;\n$return .= htmlspecialchars( $action, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\" method=\"post\" \nCONTENT;\n\nforeach ( $attributes as $k => $v ):\n$return .= <<<CONTENT\n\nCONTENT;\n$return .= htmlspecialchars( $k, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n=\"\nCONTENT;\n$return .= htmlspecialchars( $v, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\"\nCONTENT;\n\nendforeach;\n$return .= <<<CONTENT\n data-ipsForm>\n\t\t<input type=\"hidden\" name=\"\nCONTENT;\n$return .= htmlspecialchars( $id, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n_submitted\" value=\"1\">\n\t\t\nCONTENT;\n\nforeach ( $hiddenValues as $k => $v ):\n$return .= <<<CONTENT\n\n\t\t\t<input type=\"hidden\" name=\"\nCONTENT;\n$return .= htmlspecialchars( $k, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\" value=\"\nCONTENT;\n$return .= htmlspecialchars( $v, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\">\n\t\t\nCONTENT;\n\nendforeach;\n$return .= <<<CONTENT\n\n\t\t<div class=\"ipsGrid\">\n\t\t\t<div class=\"ipsGrid ipsGrid_span4\">\n\t\t\t\t{$elements['']['departments']->html()}\n\t\t\t<\/div>\n\t\t\t<div class=\"ipsGrid ipsGrid_span4\">\n\t\t\t\t{$elements['']['statuses']->html()}\n\t\t\t<\/div>\n\t\t\t<div class=\"ipsGrid ipsGrid_span2\">\n\t\t\t\t<button type=\"submit\" class=\"ipsButton ipsButton_primary ipsButton_fullWidth ipsButton_medium\">\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'update', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/button>\n\t\t\t<\/div>\n\t\t\t<div class=\"ipsGrid ipsGrid_span2\">\n\t\t\t\t<a href=\"\nCONTENT;\n\n$return .= str_replace( '&', '&amp;', \\IPS\\Http\\Url::internal( \"app=nexus&module=support&controller=requests&do=resetMyDepartments\", null, \"\", array(), 0 ) );\n$return .= <<<CONTENT\n\" class=\"ipsButton ipsButton_alternate ipsButton_fullWidth ipsButton_medium\">\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'reset', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a>\n\t\t\t<\/div>\n\t\t<\/div>\n\t<\/form>\n<\/div>\nCONTENT;\n\n\t\treturn $return;\n}\n\n\tfunction myHistory( $date, $tomorrow, $yesterday, $iterator, $pagination, $tracked, $chart, $stats ) {\n\t\t$return = '';\n\t\t$return .= <<<CONTENT\n\n\n<div class='ipsBox'>\n\t<h1 class='ipsBox_titleBar'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'past_30_days', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/h1>\n\t<div class='ipsPad'>\n\t\t<div class='ipsSpacer_top ipsSpacer_half ipsGrid ipsGrid_collapsePhone'>\n\t\t\t<div class='ipsGrid_span3'>\n\t\t\t\t<p class='ipsType_reset cNexusHistoryStat \nCONTENT;\n\nif ( $stats['totalRepliesThis'] > $stats['totalRepliesPrev'] ):\n$return .= <<<CONTENT\ncNexusHistoryStat_positive\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\ncNexusHistoryStat_negative\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n'>\n\t\t\t\t\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->formatNumber( $stats['totalRepliesThis'] );\n$return .= <<<CONTENT\n\n\t\t\t\t\nCONTENT;\n\nif ( $stats['totalRepliesThis'] > $stats['totalRepliesPrev'] ):\n$return .= <<<CONTENT\n\n\t\t\t\t<span class='cNexusHistoryStat_arrow ipsCursor_pointer' title='\nCONTENT;\n\n$sprintf = array($stats['totalRepliesPrev']); $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'support_history_up', ENT_DISALLOWED, 'UTF-8', FALSE ), FALSE, array( 'sprintf' => $sprintf ) );\n$return .= <<<CONTENT\n' data-ipsTooltip><i class='fa fa-arrow-up'><\/i><\/span>\n\t\t\t\t\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n\t\t\t\t<span class='cNexusHistoryStat_arrow ipsCursor_pointer' title='\nCONTENT;\n\n$sprintf = array($stats['totalRepliesPrev']); $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'support_history_down', ENT_DISALLOWED, 'UTF-8', FALSE ), FALSE, array( 'sprintf' => $sprintf ) );\n$return .= <<<CONTENT\n' data-ipsTooltip><i class='fa fa-arrow-down'><\/i><\/span>\n\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t<\/p>\n\t\t\t\t<h3 class='ipsType_minorHeading cNexusHistoryStat_title ipsType_noWrap ipsTruncate ipsTruncate_line'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'support_history_total_replies', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/h3>\n\t\t\t<\/div>\n\t\t\t<div class='ipsGrid_span3'>\n\t\t\t\t<p class='ipsType_reset cNexusHistoryStat \nCONTENT;\n\nif ( $stats['customersHelpedThis'] > $stats['customersHelpedPrev'] ):\n$return .= <<<CONTENT\ncNexusHistoryStat_positive\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\ncNexusHistoryStat_negative\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n'>\n\t\t\t\t\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->formatNumber( $stats['customersHelpedThis'] );\n$return .= <<<CONTENT\n\n\t\t\t\t\nCONTENT;\n\nif ( $stats['customersHelpedThis'] > $stats['customersHelpedPrev'] ):\n$return .= <<<CONTENT\n\n\t\t\t\t<span class='cNexusHistoryStat_arrow ipsCursor_pointer' title='\nCONTENT;\n\n$sprintf = array($stats['customersHelpedPrev']); $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'support_history_up', ENT_DISALLOWED, 'UTF-8', FALSE ), FALSE, array( 'sprintf' => $sprintf ) );\n$return .= <<<CONTENT\n' data-ipsTooltip><i class='fa fa-arrow-up'><\/i><\/span>\n\t\t\t\t\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n\t\t\t\t<span class='cNexusHistoryStat_arrow ipsCursor_pointer' title='\nCONTENT;\n\n$sprintf = array($stats['customersHelpedPrev']); $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'support_history_down', ENT_DISALLOWED, 'UTF-8', FALSE ), FALSE, array( 'sprintf' => $sprintf ) );\n$return .= <<<CONTENT\n' data-ipsTooltip><i class='fa fa-arrow-down'><\/i><\/span>\n\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t<\/p>\n\t\t\t\t<h3 class='ipsType_minorHeading cNexusHistoryStat_title ipsType_noWrap ipsTruncate ipsTruncate_line'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'support_history_customers', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/h3>\n\t\t\t<\/div>\n\t\t\t<div class='ipsGrid_span3'>\n\t\t\t\t<p class='ipsType_reset cNexusHistoryStat \nCONTENT;\n\nif ( $stats['issuesResolvedThis'] > $stats['issuesResolvedPrev'] ):\n$return .= <<<CONTENT\ncNexusHistoryStat_positive\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\ncNexusHistoryStat_negative\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n'>\n\t\t\t\t\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->formatNumber( $stats['issuesResolvedThis'] );\n$return .= <<<CONTENT\n\n\t\t\t\t\nCONTENT;\n\nif ( $stats['issuesResolvedThis'] > $stats['issuesResolvedPrev'] ):\n$return .= <<<CONTENT\n\n\t\t\t\t<span class='cNexusHistoryStat_arrow ipsCursor_pointer' title='\nCONTENT;\n\n$sprintf = array($stats['issuesResolvedPrev']); $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'support_history_up', ENT_DISALLOWED, 'UTF-8', FALSE ), FALSE, array( 'sprintf' => $sprintf ) );\n$return .= <<<CONTENT\n' data-ipsTooltip><i class='fa fa-arrow-up'><\/i><\/span>\n\t\t\t\t\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n\t\t\t\t<span class='cNexusHistoryStat_arrow ipsCursor_pointer' title='\nCONTENT;\n\n$sprintf = array($stats['issuesResolvedPrev']); $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'support_history_down', ENT_DISALLOWED, 'UTF-8', FALSE ), FALSE, array( 'sprintf' => $sprintf ) );\n$return .= <<<CONTENT\n' data-ipsTooltip><i class='fa fa-arrow-down'><\/i><\/span>\n\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t<\/p>\n\t\t\t\t<h3 class='ipsType_minorHeading cNexusHistoryStat_title ipsType_noWrap ipsTruncate ipsTruncate_line'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'support_history_resolved', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/h3>\n\t\t\t<\/div>\n\t\t\t\nCONTENT;\n\nif ( \\IPS\\Settings::i()->nexus_support_satisfaction ):\n$return .= <<<CONTENT\n\n\t\t\t<div class='ipsGrid_span3'>\n\t\t\t\t<ul class=\"ipsList_inline ipsClearfix ipsRating ipsRating_large\">\n\t\t\t\t\t\nCONTENT;\n\nforeach ( range( 1, 5 ) as $i ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\nCONTENT;\n\nif ( $i <= $stats['averageRatingThis'] ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t<li class='ipsRating_on'>\n\t\t\t\t\t\t<i class='fa fa-star'><\/i>\n\t\t\t\t\t<\/li>\n\t\t\t\t\t\nCONTENT;\n\nelseif ( ( $i - 0.5 ) <= $stats['averageRatingThis'] ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t<li class='ipsRating_half'>\n\t\t\t\t\t\t<i class='fa fa-star-half'><\/i><i class='fa fa-star-half fa-flip-horizontal'><\/i>\n\t\t\t\t\t<\/li>\n\t\t\t\t\t\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n\t\t\t\t\t<li class='ipsRating_off'>\n\t\t\t\t\t\t<i class='fa fa-star'><\/i>\n\t\t\t\t\t<\/li>\n\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\nCONTENT;\n\nendforeach;\n$return .= <<<CONTENT\n\n\t\t\t\t\t<li>\n\t\t\t\t\t\t<span class='ipsType_reset cNexusHistoryStat \nCONTENT;\n\nif ( $stats['averageRatingThis'] > $stats['averageRatingPrev'] ):\n$return .= <<<CONTENT\ncNexusHistoryStat_positive\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\ncNexusHistoryStat_negative\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n'>\n\t\t\t\t\t\t\nCONTENT;\n\nif ( $stats['averageRatingThis'] > $stats['averageRatingPrev'] ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t&nbsp;<span class='cNexusHistoryStat_arrow ipsCursor_pointer cNexusHistoryStat_positive' title='\nCONTENT;\n\n$sprintf = array($stats['averageRatingPrev']); $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'support_history_up', ENT_DISALLOWED, 'UTF-8', FALSE ), FALSE, array( 'sprintf' => $sprintf ) );\n$return .= <<<CONTENT\n' data-ipsTooltip><i class='fa fa-arrow-up'><\/i><\/span>\n\t\t\t\t\t\t\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t&nbsp;<span class='cNexusHistoryStat_arrow ipsCursor_pointer cNexusHistoryStat_negative' title='\nCONTENT;\n\n$sprintf = array($stats['averageRatingPrev']); $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'support_history_down', ENT_DISALLOWED, 'UTF-8', FALSE ), FALSE, array( 'sprintf' => $sprintf ) );\n$return .= <<<CONTENT\n' data-ipsTooltip><i class='fa fa-arrow-down'><\/i><\/span>\n\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t<\/span>\n\t\t\t\t\t<\/li>\n\t\t\t\t<\/ul>\n\t\t\t\t<h3 class='ipsType_minorHeading cNexusHistoryStat_title ipsType_noWrap ipsTruncate ipsTruncate_line'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'average_rating', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/h3>\n\t\t\t<\/div>\n\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t<\/div>\n\t\t<hr class='ipsHr'>\n\t\t{$chart}\n\t<\/div>\n<\/div>\n\n<hr class='ipsHr'>\n\n\n<div class=\"\" id='elNexusStaffDailyReview'>\n\t<div class='ipsPad'>\n\t\t<nav class=\"ipsPager ipsPager_small ipsGrid ipsClearFix ipsList_inline ipsSpacer_bottom ipsSpacer_double\">\n\t\t\t<div class=\"ipsGrid_span3 ipsPager_prev\">\n\t\t\t\t<a href=\"\nCONTENT;\n\n$return .= str_replace( '&', '&amp;', \\IPS\\Http\\Url::internal( \"app=nexus&module=support&controller=requests&do=history&date=\", null, \"\", array(), 0 ) );\n$return .= <<<CONTENT\n\nCONTENT;\n$return .= htmlspecialchars( $yesterday->getTimestamp(), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\" title=\"\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'prev', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\">\n\t\t\t\t\t<span class=\"ipsPager_type\">\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'support_history_prev_day', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/span>\n\t\t\t\t\t<span class=\"ipsPager_title ipsType_break ipsTruncate ipsTruncate_line\">\nCONTENT;\n$return .= htmlspecialchars( $yesterday->dayAndMonth(), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n<\/span>\n\t\t\t\t<\/a>\n\t\t\t<\/div>\n\t\t\t<div class=\"ipsGrid_span6 ipsType_center\">\n\t\t\t\t<h1 class=\"ipsType_pageTitle ipsType_center\">\nCONTENT;\n\n$sprintf = array($date->dayAndMonth()); $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'support_history_daily_review', ENT_DISALLOWED, 'UTF-8', FALSE ), FALSE, array( 'sprintf' => $sprintf ) );\n$return .= <<<CONTENT\n<\/h1>\n\t\t\t\t<a href=\"#elDateJump_menu\" data-ipsMenu id=\"elDateJump\">\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'support_history_go_to_date', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n <i class=\"fa fa-chevron-down\"><\/i><\/a>\n\t\t\t\t<div class=\"ipsMenu ipsMenu_auto ipsMenu_withStem ipsHide\" id=\"elDateJump_menu\">\n\t\t\t\t\t<form accept-charset='utf-8' action=\"\nCONTENT;\n\n$return .= str_replace( '&', '&amp;', \\IPS\\Http\\Url::internal( \"app=nexus&module=support&controller=requests&do=history\", null, \"\", array(), 0 ) );\n$return .= <<<CONTENT\n\" method=\"post\" data-ipsForm>\n\t\t\t\t\t\t<div class=\"ipsPad\">\n\t\t\t\t\t\t\t<input type=\"date\" name=\"date_jump\" data-control=\"date\" placeholder='\nCONTENT;\n\n$return .= htmlspecialchars( str_replace( array( 'YYYY', 'MM', 'DD' ), array( \\IPS\\Member::loggedIn()->language()->addToStack('_date_format_yyyy'), \\IPS\\Member::loggedIn()->language()->addToStack('_date_format_mm'), \\IPS\\Member::loggedIn()->language()->addToStack('_date_format_dd') ), str_replace( 'Y', 'YY', \\IPS\\Member::loggedIn()->language()->preferredDateFormat() ) ), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n'>\n\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t<div class=\"ipsAreaBackground ipsPad_half ipsType_center\">\n\t\t\t\t\t\t\t<input type=\"submit\" class=\"ipsButton ipsButton_primary\" value=\"\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'go', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\">\n\t\t\t\t\t\t<\/div>\n\t\t\t\t\t<\/form>\n\t\t\t\t<\/div>\n\t\t\t<\/div>\n\t\t\t<div class=\"ipsGrid_span3 ipsType_right ipsPager_next\">\n\t\t\t\t\nCONTENT;\n\nif ( $tomorrow->getTimestamp() < time() ):\n$return .= <<<CONTENT\n\n\t\t\t\t<a href=\"\nCONTENT;\n\n$return .= str_replace( '&', '&amp;', \\IPS\\Http\\Url::internal( \"app=nexus&module=support&controller=requests&do=history&date=\", null, \"\", array(), 0 ) );\n$return .= <<<CONTENT\n\nCONTENT;\n$return .= htmlspecialchars( $tomorrow->getTimestamp(), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\" title=\"\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'next', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\">\n\t\t\t\t\t<span class=\"ipsPager_type\">\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'support_history_next_day', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/span>\n\t\t\t\t\t<span class=\"ipsPager_title ipsType_break ipsTruncate ipsTruncate_line\">\nCONTENT;\n$return .= htmlspecialchars( $tomorrow->dayAndMonth(), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n<\/span>\n\t\t\t\t<\/a>\n\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t<\/div>\n\t\t<\/nav>\n\n\t\t\nCONTENT;\n\nif ( count( $iterator ) ):\n$return .= <<<CONTENT\n\n\t\t\nCONTENT;\n\nif ( trim( $pagination ) !== '' ):\n$return .= <<<CONTENT\n\n\t\t<div class='ipsSpacer_bottom'>\n\t\t\t{$pagination}\n\t\t<\/div>\n\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t<ul class='ipsList_reset' id='elNexusStaffTimeline'>\n\t\t\t\nCONTENT;\n\nforeach ( $iterator as $reply ):\n$return .= <<<CONTENT\n\n\t\t\t<li class='\nCONTENT;\n\nif ( $reply instanceof \\IPS\\nexus\\Support\\Reply and $reply->type == $reply::REPLY_HIDDEN ):\n$return .= <<<CONTENT\ncTimelineStaffNote\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n'>\n\t\t\t\t\t\t<span class='cTimelineTime'>\n\t\t\t\t\t\t\t\nCONTENT;\n\nif ( $replyDate = $reply instanceof \\IPS\\nexus\\Support\\Reply ? \\IPS\\DateTime::ts( $reply->date ) : $reply->date ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\nCONTENT;\n\nif ( mb_strpos( \\IPS\\DateTime::localeTimeFormat(), '%p' ) === FALSE ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\nCONTENT;\n\n$return .= htmlspecialchars( $replyDate->localeTime( FALSE ), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\nCONTENT;\n\n$return .= htmlspecialchars( $replyDate->strFormat( trim( str_replace( '%p', '', \\IPS\\DateTime::localeTimeFormat() ) ) ), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n<span>\nCONTENT;\n\n$return .= htmlspecialchars( $replyDate->strFormat( '%p' ), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n<\/span>\n\t\t\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t<\/span>\n\t\t\t\t\t\t<span class='cTimelineIcon'>\n\t\t\t\t\t\t\t\nCONTENT;\n\nif ( $reply instanceof \\IPS\\nexus\\Support\\Reply ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\nCONTENT;\n\nif ( $reply->type == $reply::REPLY_HIDDEN ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t<i class='fa fa-low-vision'><\/i>\n\t\t\t\t\t\t\t\t\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t<i class='fa fa-comment'><\/i>\n\t\t\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\nCONTENT;\n\nif ( $reply->action === 'status' ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t<i class='fa fa-tag'><\/i>\n\t\t\t\t\t\t\t\t\nCONTENT;\n\nelseif ( $reply->action === 'department' ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t<i class='fa fa-folder'><\/i>\n\t\t\t\t\t\t\t\t\nCONTENT;\n\nelseif ( $reply->action === 'severity' ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t<i class='fa fa-exclamation'><\/i>\n\t\t\t\t\t\t\t\t\nCONTENT;\n\nelseif ( $reply->action === 'purchase' ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nif ( $reply->new ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t\nCONTENT;\n\n$link = \"<a href='{$reply->new->acpUrl()}'>{$reply->new->name}<\/a>\";\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t<i class='fa fa-cube'><\/i>\n\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t<i class='fa fa-minus-circle'><\/i>\n\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\nCONTENT;\n\nelseif ( $reply->action === 'staff' ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nif ( $reply->new ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t<i class='fa fa-user'><\/i>\n\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t<i class='fa fa-minus-circle'><\/i>\n\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\nCONTENT;\n\nelseif ( $reply->action === 'split_away' ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t<i class='fa fa-expand'><\/i>\n\t\t\t\t\t\t\t\t\nCONTENT;\n\nelseif ( $reply->action === 'split_new' ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t<i class='fa fa-expand'><\/i> \n\t\t\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t<\/span>\n\t\t\t\t<div class='ipsAreaBackground_reset ipsPad'>\n\t\t\t\t\t<p class='cTimelineAction'>\n\t\t\t\t\t\t\nCONTENT;\n\nif ( $reply instanceof \\IPS\\nexus\\Support\\Reply ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\nCONTENT;\n\ntry { $request = \\IPS\\nexus\\Support\\Request::loadAndCheckPerms( $reply->request ); } catch( \\OutOfRangeException $e ) { $request = NULL; } \n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t<strong>\nCONTENT;\n\nif ( $reply->type == $reply::REPLY_HIDDEN ):\n$return .= <<<CONTENT\n\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'request_added_note_u', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'request_replied_u', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n<\/strong> \n\t\t\t\t\t\t\t\nCONTENT;\n\n$sprintf = array($reply->request); $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'support_history_to_req', ENT_DISALLOWED, 'UTF-8', FALSE ), FALSE, array( 'sprintf' => $sprintf ) );\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\nCONTENT;\n\n$request = $reply->request;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\nCONTENT;\n\nif ( $reply->action === 'status' ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t<strong>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'support_history_status_1', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/strong> \nCONTENT;\n\n$sprintf = array($reply->request->id); $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'support_history_status_2', ENT_DISALLOWED, 'UTF-8', FALSE ), FALSE, array( 'sprintf' => $sprintf ) );\n$return .= <<<CONTENT\n \nCONTENT;\n\n$return .= \\IPS\\Theme::i()->getTemplate( \"support\", \\IPS\\Request::i()->app )->status( $reply->new );\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\nCONTENT;\n\nelseif ( $reply->action === 'department' ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t<strong>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'support_history_department_1', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/strong> \nCONTENT;\n\n$sprintf = array($reply->request->id, $reply->new ? $reply->new->_title : '?'); $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'support_history_department_2', ENT_DISALLOWED, 'UTF-8', FALSE ), FALSE, array( 'sprintf' => $sprintf ) );\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\nCONTENT;\n\nelseif ( $reply->action === 'severity' ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t<strong>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'support_history_severity_1', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/strong> \nCONTENT;\n\n$sprintf = array($reply->request->id, $reply->new ? $reply->new->_title : '?'); $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'support_history_severity_2', ENT_DISALLOWED, 'UTF-8', FALSE ), FALSE, array( 'sprintf' => $sprintf ) );\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\nCONTENT;\n\nelseif ( $reply->action === 'purchase' ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\nCONTENT;\n\nif ( $reply->new ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t<strong>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'support_history_purchase_1', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/strong> \nCONTENT;\n\n$sprintf = array($reply->request->id, $reply->new->acpUrl(), $reply->new->name); $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'support_history_purchase_2', ENT_DISALLOWED, 'UTF-8', FALSE ), FALSE, array( 'sprintf' => $sprintf ) );\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t<strong>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'support_history_no_purchase_1', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/strong> \nCONTENT;\n\n$sprintf = array($reply->request->id); $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'support_history_no_purchase_2', ENT_DISALLOWED, 'UTF-8', FALSE ), FALSE, array( 'sprintf' => $sprintf ) );\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\nCONTENT;\n\nelseif ( $reply->action === 'staff' ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\nCONTENT;\n\nif ( $reply->new ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t<strong>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'support_history_assigned_1', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/strong> \nCONTENT;\n\n$sprintf = array($reply->request->id, $reply->new->name); $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'support_history_assigned_2', ENT_DISALLOWED, 'UTF-8', FALSE ), FALSE, array( 'sprintf' => $sprintf ) );\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t<strong>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'support_history_unassigned_1', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/strong> \nCONTENT;\n\n$sprintf = array($reply->request->id); $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'support_history_unassigned_2', ENT_DISALLOWED, 'UTF-8', FALSE ), FALSE, array( 'sprintf' => $sprintf ) );\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\nCONTENT;\n\nelseif ( $reply->action === 'split_away' ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t<strong>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'support_history_split_away_1', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/strong> \nCONTENT;\n\n$sprintf = array($reply->request->id); $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'support_history_split_away_2', ENT_DISALLOWED, 'UTF-8', FALSE ), FALSE, array( 'sprintf' => $sprintf ) );\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\nCONTENT;\n\nelseif ( $reply->action === 'split_new' ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t<strong>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'support_history_split_new_1', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/strong> \nCONTENT;\n\n$sprintf = array($reply->request->id); $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'support_history_split_new_2', ENT_DISALLOWED, 'UTF-8', FALSE ), FALSE, array( 'sprintf' => $sprintf ) );\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t<\/p>\n\t\t\t\t\t\nCONTENT;\n\nif ( $request ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t<h3 class='ipsType_reset'>\n\t\t\t\t\t\t\nCONTENT;\n\nif ( $request->unread() ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t<a href=\"\nCONTENT;\n$return .= htmlspecialchars( $request->acpUrl()->setQueryString( 'do', 'getNewComment' ), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\" title=\"\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'support_go_to_unread', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\" data-ipsTooltip>\n\t\t\t\t\t\t\t\t\t\t\t<span class='ipsItemStatus'>\n\t\t\t\t\t\t\t\t\t\t\t\t<i class=\"fa \nCONTENT;\n\nif ( array_key_exists( $request->id, $tracked ) ):\n$return .= <<<CONTENT\nbookmark\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\nfa-circle\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\"><\/i>\n\t\t\t\t\t\t\t\t\t\t\t<\/span>\n\t\t\t\t\t\t<\/a>\n\t\t\t\t\t\t\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\nCONTENT;\n\nif ( array_key_exists( $request->id, $tracked ) ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t\t<span class='ipsItemStatus ipsItemStatus_read ipsItemStatus_posted'>\n\t\t\t\t\t\t\t\t\t\t\t\t<i class=\"fa fa-bookmark\"><\/i>\n\t\t\t\t\t\t\t\t\t\t\t<\/span>\n\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t<a href=\"\nCONTENT;\n$return .= htmlspecialchars( $request->acpUrl(), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\" class='ipsType_blendLinks'>\n\t\t\t\t\t\t\t\nCONTENT;\n\nif ( $request->unread() ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t<strong>\nCONTENT;\n$return .= htmlspecialchars( $request->title, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n<\/strong>\n\t\t\t\t\t\t\t\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\nCONTENT;\n$return .= htmlspecialchars( $request->title, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t<\/a>\n\t\t\t\t\t<\/h3>\n\t\t\t\t\t\nCONTENT;\n\nif ( $reply instanceof \\IPS\\nexus\\Support\\Reply ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t<div class=\"ipsSpacer_bottom ipsSpacer_half\">\n\t\t\t\t\t\t\nCONTENT;\n\nif ( $request->severity and $request->severity->color != '000' ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t<span class='cNexusSupportBadge' style=\"background-color: #\nCONTENT;\n$return .= htmlspecialchars( $request->severity->color, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\">\nCONTENT;\n$return .= htmlspecialchars( $request->severity->_title, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n<\/span>\n\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t<span class=\"ipsType_normal ipsType_reset\">\nCONTENT;\n\n$sprintf = array($request->department->_title); $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'in_department', ENT_DISALLOWED, 'UTF-8', FALSE ), FALSE, array( 'sprintf' => $sprintf ) );\n$return .= <<<CONTENT\n<\/span>\n\t\t\t\t\t\t\nCONTENT;\n\nif ( $request->staff ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t<strong class=\"ipsType_success\">\n\t\t\t\t\t\t\t\nCONTENT;\n\n$sprintf = array($request->staff->name); $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'assigned_to_x', ENT_DISALLOWED, 'UTF-8', FALSE ), FALSE, array( 'sprintf' => $sprintf ) );\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t<\/strong>\n\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t<\/div>\n\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\nCONTENT;\n\nif ( $reply instanceof \\IPS\\nexus\\Support\\Reply ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t<hr class='ipsHr'>\n\t\t\t\t\t<div class='ipsType_richText ipsType_normal' data-ipsTruncate data-ipsTruncate-size='5 lines'>\n\t\t\t\t\t\t{$reply->truncated()}\n\t\t\t\t\t<\/div>\n\t\t\t\t\t\nCONTENT;\n\nif ( $reply->type === $reply::REPLY_STAFF and \\IPS\\Settings::i()->nexus_support_satisfaction and \\IPS\\Member::loggedIn()->hasAcpRestriction( 'nexus', 'support', 'requests_ratings' and $reply->ratingData['rating_rating']) ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t<hr class='ipsHr'>\n\t\t\t\t\t<div class=\"ipsType_medium\">\n\t\t\t\t\t\t<ul class='ipsList_inline ipsClearfix ipsRating'>\n\t\t\t\t\t\t\t\nCONTENT;\n\nforeach ( range( 1, 5 ) as $i ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t<li class='\nCONTENT;\n\nif ( $reply->ratingData['rating_rating'] and $reply->ratingData['rating_rating'] >= $i ):\n$return .= <<<CONTENT\nipsRating_on\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n'><i class='fa fa-star'><\/i><\/li>\n\t\t\t\nCONTENT;\n\nendforeach;\n$return .= <<<CONTENT\n\n\t\t<\/ul>\n\t\t&nbsp;\n\t\t\nCONTENT;\n\nif ( $reply->ratingData['rating_note'] and \\IPS\\Member::loggedIn()->hasAcpRestriction( 'nexus', 'support', 'requests_ratings_feedback' ) ):\n$return .= <<<CONTENT\n\n\t\t<a href=\"\nCONTENT;\n\n$return .= str_replace( '&', '&amp;', \\IPS\\Http\\Url::internal( \"app=nexus&module=support&controller=request&do=feedback&id={$reply->id}\", null, \"\", array(), 0 ) );\n$return .= <<<CONTENT\n\" data-ipsDialog>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'customer_rating_nc', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a>\n\t\t\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n\t\t\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'customer_rating_nc', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\n\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t<\/div>\n\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n<\/div>\n<\/li>\n\nCONTENT;\n\nendforeach;\n$return .= <<<CONTENT\n\n<\/ul>\n\nCONTENT;\n\nif ( trim( $pagination ) !== '' ):\n$return .= <<<CONTENT\n\n<div class='ipsSpacer_top'>\n\t{$pagination}\n<\/div>\n\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'no_results', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\n\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n<\/div>\n<\/div>\nCONTENT;\n\n\t\treturn $return;\n}\n\n\tfunction noteForm( $request, $id, $action, $elements, $hiddenValues, $actionButtons, $uploadField, $class='', $attributes=array(), $sidebar, $form=NULL ) {\n\t\t$return = '';\n\t\t$return .= <<<CONTENT\n\n\n<form accept-charset='utf-8' class=\"cNexusSupportForm cNexusSupportForm_note ipsComposeArea ipsForm \nCONTENT;\n$return .= htmlspecialchars( $class, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\" action=\"\nCONTENT;\n$return .= htmlspecialchars( $action, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\" method=\"post\" \nCONTENT;\n\nif ( $uploadField ):\n$return .= <<<CONTENT\nenctype=\"multipart\/form-data\"\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n \nCONTENT;\n\nforeach ( $attributes as $k => $v ):\n$return .= <<<CONTENT\n\nCONTENT;\n$return .= htmlspecialchars( $k, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n=\"\nCONTENT;\n$return .= htmlspecialchars( $v, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\"\nCONTENT;\n\nendforeach;\n$return .= <<<CONTENT\n data-ipsForm id='elNoteForm_form'>\n\t<input type=\"hidden\" name=\"\nCONTENT;\n$return .= htmlspecialchars( $id, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n_submitted\" value=\"1\">\n\t\nCONTENT;\n\nforeach ( $hiddenValues as $k => $v ):\n$return .= <<<CONTENT\n\n\t\t\nCONTENT;\n\nif ( is_array($v) ):\n$return .= <<<CONTENT\n\n\t\t\t\nCONTENT;\n\nforeach ( $v as $_k => $_v ):\n$return .= <<<CONTENT\n\n\t\t\t\t<input type=\"hidden\" name=\"\nCONTENT;\n$return .= htmlspecialchars( $k, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n[\nCONTENT;\n$return .= htmlspecialchars( $_k, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n]\" value=\"\nCONTENT;\n$return .= htmlspecialchars( $_v, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\">\n\t\t\t\nCONTENT;\n\nendforeach;\n$return .= <<<CONTENT\n\n\t\t\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n\t\t\t<input type=\"hidden\" name=\"\nCONTENT;\n$return .= htmlspecialchars( $k, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\" value=\"\nCONTENT;\n$return .= htmlspecialchars( $v, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\">\n\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\nCONTENT;\n\nendforeach;\n$return .= <<<CONTENT\n\n\t\nCONTENT;\n\nif ( $uploadField ):\n$return .= <<<CONTENT\n\n\t\t<input type=\"hidden\" name=\"MAX_FILE_SIZE\" value=\"\nCONTENT;\n$return .= htmlspecialchars( $uploadField, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\">\n\t\t<input type=\"hidden\" name=\"plupload\" value=\"\nCONTENT;\n\n$return .= htmlspecialchars( md5( mt_rand() ), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\">\n\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\n\t\nCONTENT;\n\nif ( $elements['']['note'] ):\n$return .= <<<CONTENT\n\n\t\t<div class='cNexusSupportForm_message'>\n\t\t\t{$elements['']['note']->html()}\n\t\t<\/div>\n\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\n\t<div class='ipsAreaBackground ipsClearfix ipsPad_half ipsType_right' data-ipsEditor-toolList>\n\t\t<ul class='ipsList_inline ipsPos_left ipsType_left cNexusSupportForm_controls'>\n\t\t\t\nCONTENT;\n\nif ( isset( $elements['']['status'] ) ):\n$return .= <<<CONTENT\n\n\t\t\t\t<li>\n\t\t\t\t\t<h3 class='ipsType_minorHeading'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'status', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/h3>\n\t\t\t\t\t{$elements['']['status']->html()}\n\t\t\t\t<\/li>\n\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\nCONTENT;\n\nif ( isset( $elements['']['department'] ) ):\n$return .= <<<CONTENT\n\n\t\t\t\t<li>\n\t\t\t\t\t<h3 class='ipsType_minorHeading'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'department', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/h3>\n\t\t\t\t\t{$elements['']['department']->html()}\n\t\t\t\t<\/li>\n\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\nCONTENT;\n\nif ( isset( $elements['']['assign_to'] ) ):\n$return .= <<<CONTENT\n\n\t\t\t\t<li>\n\t\t\t\t\t<h3 class='ipsType_minorHeading'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'assign_to', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/h3>\n\t\t\t\t\t{$elements['']['assign_to']->html()}\n\t\t\t\t<\/li>\n\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t<\/ul>\n\t\t<button type='submit' class='ipsButton ipsButton_primary ipsButton_large'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'add_note', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/button>\n\t<\/div>\n<\/form>\nCONTENT;\n\n\t\treturn $return;\n}\n\n\tfunction replyContainer( $item, $comment, $condensed=FALSE ) {\n\t\t$return = '';\n\t\t$return .= <<<CONTENT\n\n<div class=\"cNexusAdminSupportMessage cNexusAdminSupportMessage_\nCONTENT;\n$return .= htmlspecialchars( $comment->type, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n ipsBox\">\n\t<div class='cNexusAdminSupportMessage_author ipsFaded_withHover ipsType_normal'>\n\t\t\nCONTENT;\n\nif ( !$condensed ):\n$return .= <<<CONTENT\n\n\t\t\t<ul class=\"ipsList_inline ipsPos_right\">\n\t\t\t\t\nCONTENT;\n\nif ( \\IPS\\Member::loggedIn()->hasAcpRestriction( 'nexus', 'support', 'requests_split' ) or \\IPS\\Member::loggedIn()->hasAcpRestriction( 'nexus', 'support', 'requests_reply_delete' ) ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t<li>\n\t\t\t\t\t\t<span class='ipsCustomInput'>\n\t\t\t\t\t\t\t<input type=\"checkbox\" name=\"multimod[\nCONTENT;\n$return .= htmlspecialchars( $comment->id, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n]\" value=\"1\" data-role=\"moderation\" data-ipsTooltip\n\t\t\t\t\t\t\t\t\nCONTENT;\n\nif ( \\IPS\\Member::loggedIn()->hasAcpRestriction( 'nexus', 'support', 'requests_split' ) and \\IPS\\Member::loggedIn()->hasAcpRestriction( 'nexus', 'support', 'requests_reply_delete' ) ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\tdata-actions=\"split delete\"\n\t\t\t\t\t\t\t\t\ttitle=\"\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'split_or_delete', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\"\n\t\t\t\t\t\t\t\t\nCONTENT;\n\nelseif ( \\IPS\\Member::loggedIn()->hasAcpRestriction( 'nexus', 'support', 'requests_split' ) ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\tdata-actions=\"split\"\n\t\t\t\t\t\t\t\t\ttitle=\"\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'split', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\"\n\t\t\t\t\t\t\t\t\nCONTENT;\n\nelseif ( \\IPS\\Member::loggedIn()->hasAcpRestriction( 'nexus', 'support', 'requests_reply_delete' ) ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\tdata-actions=\"delete\"\n\t\t\t\t\t\t\t\t\ttitle=\"\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'delete', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\"\n\t\t\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<span><\/span>\n\t\t\t\t\t\t<\/span>\n\t\t\t\t\t<\/li>\n\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\nCONTENT;\n\nif ( \\IPS\\Member::loggedIn()->hasAcpRestriction( 'nexus', 'support', 'requests_reply_delete' ) ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t<li>\n\t\t\t\t\t\t<a href=\"\nCONTENT;\n\n$return .= str_replace( '&', '&amp;', \\IPS\\Http\\Url::internal( \"app=nexus&module=support&controller=request&do=deleteReply&id={$comment->id}\", null, \"\", array(), 0 ) );\n$return .= <<<CONTENT\n\" data-confirm data-ipsTooltip title='\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'delete', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n' class='ipsFaded ipsFaded_more ipsType_blendLinks ipsPos_right ipsType_normal'><i class='fa fa-times'><\/i><\/a>\n\t\t\t\t\t<\/li>\n\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t<\/ul>\n\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t<div class='ipsType_large ipsType_reset ipsType_blendLinks'>\n\t\t\t<strong>\n\t\t\t\t\nCONTENT;\n\nif ( $comment->type === $comment::REPLY_EMAIL ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t<span class='cNexusAdminSupportMessage_authorName'>\nCONTENT;\n$return .= htmlspecialchars( $comment->email, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n<\/span>\n\t\t\t\t\nCONTENT;\n\nelseif ( $comment->type === $comment::REPLY_MEMBER or $comment->type === $comment::REPLY_ALTCONTACT ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t<span class='cNexusAdminSupportMessage_authorName'><a href=\"\nCONTENT;\n$return .= htmlspecialchars( $comment->author()->acpUrl(), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\">\nCONTENT;\n$return .= htmlspecialchars( $comment->author()->cm_name, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n<\/a><\/span>\n\t\t\t\t\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n\t\t\t\t\t<span class='cNexusAdminSupportMessage_authorName'>\nCONTENT;\n$return .= htmlspecialchars( $comment->author()->cm_name, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n<\/span>\n\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\nCONTENT;\n\nif ( $comment->type == $comment::REPLY_HIDDEN ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'request_added_note', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\n\t\t\t\t\nCONTENT;\n\nelseif ( $comment->date == $item->started ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'request_created', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\n\t\t\t\t\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n\t\t\t\t\t\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'request_replied', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\n\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t<\/strong>\n\t\t\t&nbsp;&nbsp;<span class='ipsType_light ipsType_medium cNexusAdminSupportMessage_date ipsType_blendLinks'><a href='\nCONTENT;\n\n$return .= str_replace( '&', '&amp;', \\IPS\\Http\\Url::internal( \"app=nexus&module=support&controller=request&id={$comment->item()->id}&do=findComment&comment={$comment->id}\", null, \"\", array(), 0 ) );\n$return .= <<<CONTENT\n'>\nCONTENT;\n\n$val = ( $comment->date instanceof \\IPS\\DateTime ) ? $comment->date : \\IPS\\DateTime::ts( $comment->date );$return .= $val->html();\n$return .= <<<CONTENT\n<\/a><\/span>\n\t\t\t\nCONTENT;\n\nif ( $comment->ip_address and \\IPS\\Member::loggedIn()->hasAcpRestriction( 'core', 'members', 'membertools_ip' ) ):\n$return .= <<<CONTENT\n\n\t\t\t\t&nbsp;&nbsp;<span class='ipsType_light ipsType_medium ipsType_blendLinks'><a href='\nCONTENT;\n\n$return .= str_replace( '&', '&amp;', \\IPS\\Http\\Url::internal( \"app=core&module=members&controller=ip&ip={$comment->ip_address}\", null, \"\", array(), 0 ) );\n$return .= <<<CONTENT\n'>\nCONTENT;\n$return .= htmlspecialchars( $comment->ip_address, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n<\/a><\/span>\n\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t<ul class='ipsList_reset ipsType_medium cNexusAdminSupportMessage_cc'>\n\t\t\t\t\nCONTENT;\n\nif ( $comment->cc ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t<li><strong>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'cc', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n:<\/strong> \nCONTENT;\n$return .= htmlspecialchars( $comment->cc, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n<\/li>\n\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\nCONTENT;\n\nif ( $comment->bcc ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t<li><strong>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'bcc', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n:<\/strong> \nCONTENT;\n$return .= htmlspecialchars( $comment->cc, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n<\/li>\n\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t<\/ul>\n\t\t\t\nCONTENT;\n\nif ( $item->member and $comment->date == $item->started and $comment->type === $comment::REPLY_EMAIL ):\n$return .= <<<CONTENT\n\n\t\t\t\t<span class=\"ipsType_warning ipsType_small\"><i class=\"fa fa-warning\"><\/i> \nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'request_from_customer_email', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/span>\n\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\nCONTENT;\n\nif ( $comment->type === $comment::REPLY_ALTCONTACT ):\n$return .= <<<CONTENT\n\n\t\t\t\t<span class='ipsType_small'>\nCONTENT;\n\n$sprintf = array($item->supportAuthor()->name()); $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'request_from_alternative_contact', ENT_DISALLOWED, 'UTF-8', FALSE ), FALSE, array( 'sprintf' => $sprintf ) );\n$return .= <<<CONTENT\n<\/span>\n\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t<\/div>\n\t<\/div>\n\t<div class='ipsPad'>\n\t\t<a id=\"reply-\nCONTENT;\n$return .= htmlspecialchars( $comment->id, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\"><\/a>\n\t\t<div class='ipsType_richText ipsType_normal cNexusAdminSupportMessage_message' data-controller=\"nexus.admin.support.message\">\n\t\t\t\nCONTENT;\n\nif ( $condensed ):\n$return .= <<<CONTENT\n\n\t\t\t\t<div data-ipsTruncate data-ipsTruncate-type='remove' data-ipsTruncate-size='10 lines'>\n\t\t\t\t\t{$comment->truncated()}\n\t\t\t\t<\/div>\n\t\t\t\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n\t\t\t\t{$comment->content()}\n\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t<\/div>\n\t\t\nCONTENT;\n\nif ( !$condensed and $comment->type === $comment::REPLY_STAFF and \\IPS\\Settings::i()->nexus_support_satisfaction and \\IPS\\Member::loggedIn()->hasAcpRestriction( 'nexus', 'support', 'requests_ratings' ) ):\n$return .= <<<CONTENT\n\n\t\t\t<div class=\"ipsType_right ipsType_medium\">\n\t\t\t\t\nCONTENT;\n\nif ( $comment->ratingData['rating_rating'] ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\nCONTENT;\n\nif ( $comment->ratingData['rating_note'] and \\IPS\\Member::loggedIn()->hasAcpRestriction( 'nexus', 'support', 'requests_ratings_feedback' ) ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t<a href=\"\nCONTENT;\n\n$return .= str_replace( '&', '&amp;', \\IPS\\Http\\Url::internal( \"app=nexus&module=support&controller=request&do=feedback&id={$comment->id}\", null, \"\", array(), 0 ) );\n$return .= <<<CONTENT\n\" data-ipsDialog>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'customer_rating', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a>\n\t\t\t\t\t\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'customer_rating', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\n\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t<ul class='ipsList_inline ipsClearfix ipsRating'>\n\t\t\t\t\t\t\nCONTENT;\n\nforeach ( range( 1, 5 ) as $i ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t<li class='\nCONTENT;\n\nif ( $comment->ratingData['rating_rating'] and $comment->ratingData['rating_rating'] >= $i ):\n$return .= <<<CONTENT\nipsRating_on\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n'><i class='fa fa-star'><\/i><\/li>\n\t\t\t\t\t\t\nCONTENT;\n\nendforeach;\n$return .= <<<CONTENT\n\n\t\t\t\t\t<\/ul>\n\t\t\t\t\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n\t\t\t\t\t<span class=\"ipsType_light\">\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'customer_has_not_rated', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/span>\n\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t<\/div>\n\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t<\/div>\n\t\nCONTENT;\n\nif ( $comment->type === $comment::REPLY_PENDING ):\n$return .= <<<CONTENT\n\n\t\t<div class=\"cNexusAdminSupportMessage_actions\">\n\t\t\t\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'support_pending', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<br><br>\n\t\t\t<a href=\"\nCONTENT;\n$return .= htmlspecialchars( $item->acpUrl()->setQueryString( array( 'response' => $comment->id, 'do' => 'pending', 'send' => 1, 'department' => isset( \\IPS\\Request::i()->department ) ? \\IPS\\Request::i()->department : -1, 'status' => isset( \\IPS\\Request::i()->status ) ? \\IPS\\Request::i()->status : -1, 'staff' => isset( \\IPS\\Request::i()->staff ) ? \\IPS\\Request::i()->staff : -1 ) ), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\" class=\"ipsButton ipsButton_normal ipsButton_small\">\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'send_it', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a>\n\t\t\t<a href=\"\nCONTENT;\n$return .= htmlspecialchars( $item->acpUrl()->setQueryString( array( 'response' => $comment->id, 'do' => 'pending', 'send' => 0 ) ), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\" class=\"ipsButton ipsButton_normal ipsButton_small\">\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'discard_it', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a>\n\t\t<\/div>\t\n\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n<\/div>\nCONTENT;\n\n\t\treturn $return;\n}\n\n\tfunction request( $request, $requestActions=array() ) {\n\t\t$return = '';\n\t\t$return .= <<<CONTENT\n\n\n<div class='cWithInfoPanel cNexusSupportRequest'>\n\t<div class='cWithInfoPanel_main'>\n\t\t\nCONTENT;\n\nif ( isset( \\IPS\\Request::i()->pending ) and \\IPS\\Request::i()->pending ):\n$return .= <<<CONTENT\n\n\t\t\t<div class=\"ipsMessage ipsMessage_error ipsJS_hide\" data-controller=\"nexus.admin.support.pendingalert\">\n\t\t\t\t\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'support_pending', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\n\t\t\t<\/div>\n\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\n\t\t\nCONTENT;\n\n$purchase = $request->purchase;\n$return .= <<<CONTENT\n\n\t\t<p class=\"ipsMessage ipsMessage_error \nCONTENT;\n\nif ( ( $purchase and $purchase->active ) or !$purchase or !$request->department->require_package ):\n$return .= <<<CONTENT\nipsHide\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\" data-role=\"purchaseWarning\" data-purchaseWarning=\"purchaseWarningInactiveRequired\">\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'request_purchase_inactive', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/p>\n\t\t<p class=\"ipsMessage ipsMessage_warning \nCONTENT;\n\nif ( ( $purchase and $purchase->active ) or !$purchase or $request->department->require_package or !$request->department->packages ):\n$return .= <<<CONTENT\nipsHide\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\" data-role=\"purchaseWarning\" data-purchaseWarning=\"purchaseWarningInactiveOptional\">\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'request_purchase_inactive_optional', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/p>\n\t\t<p class=\"ipsMessage ipsMessage_error \nCONTENT;\n\nif ( $purchase or !$request->department->require_package ):\n$return .= <<<CONTENT\nipsHide\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\" data-role=\"purchaseWarning\" data-purchaseWarning=\"purchaseWarningNoneRequired\">\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'request_purchase_none', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/p>\n\t\t<p class=\"ipsMessage ipsMessage_warning \nCONTENT;\n\nif ( $purchase or $request->department->require_package or !$request->department->packages ):\n$return .= <<<CONTENT\nipsHide\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\" data-role=\"purchaseWarning\" data-purchaseWarning=\"purchaseWarningNoneOptional\">\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'request_purchase_none_optional', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/p>\n\t\t\nCONTENT;\n\nif ( $purchase ):\n$return .= <<<CONTENT\n\n\t\t\t<div class='ipsBox'>\n\t\t\t\t<h2 class='ipsBox_titleBar'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'associated_purchase', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/h2>\n\t\t\t\t<div class='ipsPad'>\n\t\t\t\t\t<div class='ipsColumns ipsColumns_collapsePhone'>\n\t\t\t\t\t\t\nCONTENT;\n\nif ( $purchase->expire and !$purchase->cancelled ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t<div class='ipsColumn ipsColumn_narrow ipsType_center'>\n\t\t\t\t\t\t\t\t\nCONTENT;\n\nif ( $purchase->cancelled || !$purchase->active ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t<span class='ipsBadge ipsBadge_icon ipsBadge_large ipsBadge_negative'>\n\t\t\t\t\t\t\t\t\t\t<i class='fa fa-times'><\/i>\n\t\t\t\t\t\t\t\t\t<\/span>\n\t\t\t\t\t\t\t\t\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t<span class='ipsBadge ipsBadge_icon ipsBadge_large ipsBadge_positive'>\n\t\t\t\t\t\t\t\t\t\t<i class='fa fa-check'><\/i>\n\t\t\t\t\t\t\t\t\t<\/span>\n\t\t\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t<p class='ipsType_large ipsType_reset ipsSpacer_top ipsSpacer_half'>\n\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nif ( $purchase->cancelled ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t<strong class='ipsType_negative'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'purchase_canceled', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/strong>\n\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nelseif ( !$purchase->active ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t<strong class='ipsType_negative'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'purchase_expired', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/strong>\n\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t<strong class='ipsType_positive'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'purchase_active', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/strong>\n\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t<\/p>\n\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t<div class='ipsColumn ipsColumn_fluid'>\n\t\t\t\t\t\t\t<h2 class='ipsType_sectionHead cNexusSupportHeader_title ipsType_blendLinks'><a href=\"\nCONTENT;\n$return .= htmlspecialchars( $purchase->acpUrl(), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\">\nCONTENT;\n$return .= htmlspecialchars( $purchase->_name, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n<\/a> <span class=\"ipsType_small ipsType_light\">#\nCONTENT;\n$return .= htmlspecialchars( $purchase->id, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n<\/span><\/h2>\n\n\t\t\t\t\t\t\t\nCONTENT;\n\nif ( $parent = $purchase->parent() ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t<p class='ipsType_reset ipsType_medium ipsType_blendLinks'>\n\t\t\t\t\t\t\t\t\t\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'ps_parent', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n:\n\t\t\t\t\t\t\t\t\t<a href=\"\nCONTENT;\n$return .= htmlspecialchars( $parent->acpUrl(), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\">\n\t\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nif ( $parent->cancelled ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t\t<i class='fa fa-times-circle' title=\"\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'purchase_canceled', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\" data-ipsTooltip><\/i>\n\t\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nelseif ( !$parent->active ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t\t<i class='fa fa-exclamation-circle' title=\"\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'purchase_expired', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\" data-ipsTooltip><\/i>\n\t\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t\nCONTENT;\n$return .= htmlspecialchars( $parent->name, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t<\/a>\n\t\t\t\t\t\t\t\t<\/p>\n\t\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\n\t\t\t\t\t\t\t\nCONTENT;\n\nif ( $purchase->childrenCount() ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t<ul class='ipsList_inline ipsType_blendLinks'>\n\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nforeach ( $purchase->children( NULL ) as $child ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nif ( $child->cancelled ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t\t\t<a href='\nCONTENT;\n$return .= htmlspecialchars( $child->acpUrl(), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n' class='ipsType_negative'><i class='fa fa-times-circle' title=\"\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'purchase_canceled', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\" data-ipsTooltip><\/i> \nCONTENT;\n$return .= htmlspecialchars( $child->name, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n<\/a>\n\t\t\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nelseif ( !$child->active ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t\t\t<a href='\nCONTENT;\n$return .= htmlspecialchars( $child->acpUrl(), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n' class='ipsType_negative'><i class='fa fa-exclamation-circle' title=\"\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'purchase_expired', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\" data-ipsTooltip><\/i> \nCONTENT;\n$return .= htmlspecialchars( $child->name, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n<\/a>\n\t\t\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t\t\t<a href='\nCONTENT;\n$return .= htmlspecialchars( $child->acpUrl(), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n' class='ipsType_positive'><i class='fa fa-check'><\/i> \nCONTENT;\n$return .= htmlspecialchars( $child->name, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n<\/a>\n\t\t\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t<\/li>\n\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nendforeach;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t<\/ul>\n\t\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t<hr class='ipsHr ipsHr_small'>\n\t\t\t\t\t\t\t<table class='cNexusSupportHeader ipsTable ipsTable_responsive' data-controller='nexus.admin.support.packageInfo'>\n\t\t\t\t\t\t\t\t\nCONTENT;\n\nif ( $purchase->renewals ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t<tr class='cNexusSupportHeader_row'>\n\t\t\t\t\t\t\t\t\t\t<td class='cNexusSupportHeader_colTitle'>\n\t\t\t\t\t\t\t\t\t\t\t\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'billing', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t<\/td>\n\t\t\t\t\t\t\t\t\t\t<td class='cNexusSupportHeader_colInfo ipsTable_wrap'>\n\t\t\t\t\t\t\t\t\t\t\t<ul class='ipsList_inline'>\n\t\t\t\t\t\t\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<i class='fa fa-refresh'><\/i> &nbsp;\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'renews', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n \nCONTENT;\n$return .= htmlspecialchars( $purchase->renewals, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t\t\t<\/li>\n\t\t\t\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nif ( $billingAgreement = $purchase->billing_agreement ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<i class='fa fa-paypal'><\/i> &nbsp;<a href=\"\nCONTENT;\n$return .= htmlspecialchars( $billingAgreement->acpUrl(), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\" class=\"ipsType_blendLinks\">\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'ps_billing_agreement', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n \nCONTENT;\n$return .= htmlspecialchars( $billingAgreement->gw_id, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n<\/a>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nif ( $billingAgreement->canceled ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t(\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'billing_agreement_canceled', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t<\/li>\n\t\t\t\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\n\t\t\t\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nif ( $purchase->grace_period ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\nCONTENT;\n\n$grace = new \\DateInterval( 'PT' . $purchase->grace_period . 'S' );\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<i class='fa fa-clock-o'><\/i> &nbsp;\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'p_grace_period', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n \nCONTENT;\n\n$return .= htmlspecialchars( \\IPS\\DateTime::formatInterval( \\IPS\\DateTime::create()->diff( \\IPS\\DateTime::create()->add( $grace ) ), 0 ), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t<\/li>\n\t\t\t\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t\t<\/ul>\n\t\t\t\t\t\t\t\t\t\t<\/td>\n\t\t\t\t\t\t\t\t\t<\/tr>\n\t\t\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t<tr class='cNexusSupportHeader_row'>\n\t\t\t\t\t\t\t\t\t<td class='cNexusSupportHeader_colTitle'>\n\t\t\t\t\t\t\t\t\t\t\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'support_purchase', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t<\/td>\n\t\t\t\t\t\t\t\t\t<td class='cNexusSupportHeader_colInfo ipsTable_wrap'>\n\t\t\t\t\t\t\t\t\t\t<ul class='ipsList_inline'>\n\t\t\t\t\t\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t\t\t\t\t\t<i class='fa fa-calendar-check-o'><\/i> &nbsp;\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'ps_start', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n \nCONTENT;\n$return .= htmlspecialchars( $purchase->start->localeDate(), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t\t<\/li>\n\t\t\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nif ( $purchase->expire ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<i class='fa fa-calendar-times-o'><\/i> &nbsp;\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'ps_expire', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n \nCONTENT;\n$return .= htmlspecialchars( $purchase->expire->localeDate(), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t\t\t<\/li>\n\t\t\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t<\/ul>\n\t\t\t\t\t\t\t\t\t<\/td>\n\t\t\t\t\t\t\t\t<\/tr>\n\t\t\t\t\t\t\t\t\nCONTENT;\n\nif ( $licenseKey = $request->purchase->licenseKey() ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t<tr class='cNexusSupportHeader_row'>\n\t\t\t\t\t\t\t\t\t\t<td class='cNexusSupportHeader_colTitle'>\n\t\t\t\t\t\t\t\t\t\t\t\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'license_key', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t<\/td>\n\t\t\t\t\t\t\t\t\t\t<td class='cNexusSupportHeader_colInfo ipsTable_wrap'>\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"ipsType_monospace cNexusLicenseKey ipsContained ipsType_break\">\n\t\t\t\t\t\t\t\t\t\t\t\t\nCONTENT;\n$return .= htmlspecialchars( $licenseKey->key, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t\t\t\t\t<\/td>\n\t\t\t\t\t\t\t\t\t<\/tr>\n\t\t\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t{$purchase->acpSupportView()}\n\t\t\t\t\t\t\t\t\nCONTENT;\n\nif ( $purchase->custom_fields ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\nCONTENT;\n\n$countRows = 0;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nforeach ( $purchase->custom_fields as $k => $v ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t\nCONTENT;\n\ntry { $pfield = \\IPS\\nexus\\Package\\CustomField::load( $k ); } catch( \\Exception $e ) { $pfield = NULL; } \n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nif ( $pfield and $displayValue = trim( $pfield->displayValue( $v, TRUE ) ) ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t\t<tr class='cNexusSupportHeader_row cNexusSupportHeader_optional \nCONTENT;\n\nif ( !isset( \\IPS\\Request::i()->cookie['showAllPackageInfo'] ) || !\\IPS\\Request::i()->cookie['showAllPackageInfo'] ):\n$return .= <<<CONTENT\nipsHide\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n'>\n\t\t\t\t\t\t\t\t\t\t\t\t<td class='cNexusSupportHeader_colTitle'>\nCONTENT;\n\n$val = \"nexus_pfield_{$k}\"; $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( $val, ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/td>\n\t\t\t\t\t\t\t\t\t\t\t\t<td class='cNexusSupportHeader_colInfo ipsTable_wrap'>{$displayValue}<\/td>\n\t\t\t\t\t\t\t\t\t\t\t<\/tr>\n\t\t\t\t\t\t\t\t\t\t\t\nCONTENT;\n\n$countRows++;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nendforeach;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nif ( $countRows ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t<tr class='cNexusSupportHeader_row'>\n\t\t\t\t\t\t\t\t\t\t\t<td colspan='2'>\n\t\t\t\t\t\t\t\t\t\t\t\t<a href='#' data-action='showFewerRows' class='\nCONTENT;\n\nif ( !isset( \\IPS\\Request::i()->cookie['showAllPackageInfo'] ) || !\\IPS\\Request::i()->cookie['showAllPackageInfo'] ):\n$return .= <<<CONTENT\nipsHide\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'show_fewer_rows', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n <i class='fa fa-angle-up'><\/i><\/a>\n\t\t\t\t\t\t\t\t\t\t\t\t<a href='#' data-action='showMoreRows' class='\nCONTENT;\n\nif ( isset( \\IPS\\Request::i()->cookie['showAllPackageInfo'] ) && \\IPS\\Request::i()->cookie['showAllPackageInfo'] ):\n$return .= <<<CONTENT\nipsHide\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n'>\nCONTENT;\n\n$pluralize = array( $countRows ); $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'show_x_rows', ENT_DISALLOWED, 'UTF-8', FALSE ), FALSE, array( 'pluralize' => $pluralize ) );\n$return .= <<<CONTENT\n <i class='fa fa-angle-down'><\/i><\/a> \n\t\t\t\t\t\t\t\t\t\t\t<\/td>\n\t\t\t\t\t\t\t\t\t\t<\/tr>\n\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t<\/table>\n\t\t\t\t\t\t<\/div>\n\t\t\t\t\t<\/div>\n\t\t\t\t<\/div>\n\t\t\t<\/div>\n\n\t\t\t<hr class='ipsHr'>\n\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\n\t\t<section class='ipsBox cNexusSupportForm' data-controller='nexus.admin.support.replyArea'>\n\t\t\t<div>\n\t\t\t\t<div class=\"ipsTabs ipsTabs_small ipsClearfix\" id=\"elSupportForm\" data-ipsTabBar data-ipsTabBar-contentArea=\"#elSupportForm_content\">\n\t\t\t\t\t<a href=\"#elSupportForm\" data-action=\"expandTabs\"><i class=\"fa fa-caret-down\"><\/i><\/a>\n\t\t\t\t\t<ul role=\"tablist\">\n\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t<a href=\"#\" id=\"elStaffForm\" class=\"ipsTabs_item ipsType_center ipsTabs_activeItem\" data-role='replyTab' role=\"tab\" aria-selected=\"true\">\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'staff_reply', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a>\n\t\t\t\t\t\t<\/li>\n\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t<a href='#' id='elNoteForm' class='ipsTabs_item ipsType_center' data-role='noteTab' role=\"tab\" aria-selected=\"false\">\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'staff_note', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a>\n\t\t\t\t\t\t<\/li>\n\t\t\t\t\t<\/ul>\n\t\t\t\t<\/div>\n\t\t\t\t<div id=\"elSupportForm_content\" class=\"ipsTabs_panels ipsClearfix\">\n\t\t\t\t\t<div id=\"ipsTabs_elSupportForm_elStaffForm_panel\" class=\"ipsTabs_panel ipsAreaBackground_reset ipsClearfix\" aria-hidden=\"false\" data-role=\"replyForm\">\n\t\t\t\t\t\t{$request->staffReplyForm()}\n\t\t\t\t\t<\/div>\n\t\t\t\t\t<div id=\"ipsTabs_elSupportForm_elNoteForm_panel\" class=\"ipsTabs_panel ipsAreaBackground_reset ipsClearfix\" aria-hidden=\"false\" data-role=\"noteForm\">\n\t\t\t\t\t\t{$request->noteForm()}\n\t\t\t\t\t<\/div>\n\t\t\t\t<\/div>\t\t\t\n\t\t\t<\/div>\n\t\t<\/section>\n\t\t\n\t\t<section class='ipsSpacer_top'>\n\t\t\t<div data-controller='core.front.core.commentFeed' \nCONTENT;\n\nif ( \\IPS\\Settings::i()->auto_polling_enabled ):\n$return .= <<<CONTENT\ndata-autoPoll\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n data-baseURL='\nCONTENT;\n$return .= htmlspecialchars( $request->acpUrl(), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n' data-feedID='request-\nCONTENT;\n$return .= htmlspecialchars( $request->id, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n'>\n\t\t\t\t\nCONTENT;\n\n$order = isset( \\IPS\\Request::i()->order ) ? \\IPS\\Request::i()->order : ( isset( \\IPS\\Request::i()->cookie['support_replies_order'] ) ? \\IPS\\Request::i()->cookie['support_replies_order'] : 'desc' );\n$return .= <<<CONTENT\n\n\n\t\t\t\t<div class='ipsClearfix'>\n\t\t\t\t\t\nCONTENT;\n\nif ( $request->commentPageCount() > 1 ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t<div class='ipsPos_left ipsResponsive_noFloat'>\n\t\t\t\t\t\t\t{$request->commentPagination( array(), 'pagination', NULL, $request->acpUrl() )}\n\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t<ul class='ipsButtonRow ipsClearfix ipsPos_right'>\n\t\t\t\t\t\t<li class='ipsPos_left'>\n\t\t\t\t\t\t\t<a href='\nCONTENT;\n\n$return .= htmlspecialchars( \\IPS\\Request::i()->url()->setQueryString( array( 'order' => 'asc', 'page' => 1 ) ), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n' class='\nCONTENT;\n\nif ( $order == 'asc' ):\n$return .= <<<CONTENT\nipsButtonRow_active\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'responses_asc', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a>\n\t\t\t\t\t\t<\/li>\n\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t<a href='\nCONTENT;\n\n$return .= htmlspecialchars( \\IPS\\Request::i()->url()->setQueryString( array( 'order' => 'desc', 'page' => 1 ) ), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n' class='\nCONTENT;\n\nif ( $order == 'desc' ):\n$return .= <<<CONTENT\nipsButtonRow_active\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'responses_desc', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a>\n\t\t\t\t\t\t<\/li>\n\t\t\t\t\t<\/ul>\n\t\t\t\t<\/div>\n\t\t\t\t\n\t\t\t\t<hr class='ipsHr'>\n\n\t\t\t\t<div data-controller='nexus.admin.support.multimod'>\n\t\t\t\t\t<form action=\"\nCONTENT;\n$return .= htmlspecialchars( $request->acpUrl()->setQueryString('do', 'multimod'), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\" method=\"post\" data-ipsPageAction data-role='moderationTools'>\n\t\t\t\t\t\t<input type=\"hidden\" name=\"csrfKey\" value=\"\nCONTENT;\n\n$return .= htmlspecialchars( \\IPS\\Session::i()->csrfKey, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\">\n\t\t\t\t\t\t\nCONTENT;\n\nforeach ( $request->repliesAndLog( $order ) as $comment ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\nCONTENT;\n\nif ( $comment instanceof \\IPS\\nexus\\Support\\Reply ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t{$comment->html()}\n\t\t\t\t\t\t\t\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t<p class='ipsType_reset ipsType_medium cNexusSupportRequest_action'>\n\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nif ( $comment->action === 'status' ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t<i class='fa fa-tag'><\/i> &nbsp;&nbsp;\nCONTENT;\n\n$sprintf = array($comment->member->name, $comment->new ? $comment->new->_title : '?'); $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'reply_action_status', ENT_DISALLOWED, 'UTF-8', FALSE ), FALSE, array( 'sprintf' => $sprintf ) );\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nelseif ( $comment->action === 'department' ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t<i class='fa fa-folder'><\/i> &nbsp;&nbsp;\nCONTENT;\n\n$sprintf = array($comment->member->name, $comment->new ? $comment->new->_title : '?'); $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'reply_action_moved', ENT_DISALLOWED, 'UTF-8', FALSE ), FALSE, array( 'sprintf' => $sprintf ) );\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nelseif ( $comment->action === 'severity' ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t<i class='fa fa-exclamation'><\/i> &nbsp;&nbsp;\nCONTENT;\n\n$sprintf = array($comment->member->name, $comment->new ? $comment->new->_title : '?'); $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'reply_action_severity', ENT_DISALLOWED, 'UTF-8', FALSE ), FALSE, array( 'sprintf' => $sprintf ) );\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nelseif ( $comment->action === 'purchase' ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nif ( $comment->new ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t\t<i class='fa fa-cube'><\/i> &nbsp;&nbsp;\nCONTENT;\n\n$sprintf = array($comment->member->name, $comment->new->acpUrl(), $comment->new->name); $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'reply_action_associate', ENT_DISALLOWED, 'UTF-8', FALSE ), FALSE, array( 'sprintf' => $sprintf ) );\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t\t<i class='fa fa-minus-circle'><\/i> &nbsp;&nbsp;\nCONTENT;\n\n$sprintf = array($comment->member->name); $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'reply_action_unassociate', ENT_DISALLOWED, 'UTF-8', FALSE ), FALSE, array( 'sprintf' => $sprintf ) );\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nelseif ( $comment->action === 'staff' ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nif ( $comment->new ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t\t<i class='fa fa-user'><\/i> &nbsp;&nbsp;\nCONTENT;\n\n$sprintf = array($comment->member->name, $comment->new->name); $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'reply_action_assign', ENT_DISALLOWED, 'UTF-8', FALSE ), FALSE, array( 'sprintf' => $sprintf ) );\n$return .= <<<CONTENT\n<\/a>\n\t\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t\t<i class='fa fa-minus-circle'><\/i> &nbsp;&nbsp;\nCONTENT;\n\n$sprintf = array($comment->member->name); $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'reply_action_unassign', ENT_DISALLOWED, 'UTF-8', FALSE ), FALSE, array( 'sprintf' => $sprintf ) );\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nelseif ( $comment->action === 'split_away' ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nif ( $comment->new ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t\t<i class='fa fa-expand'><\/i> &nbsp;&nbsp;\nCONTENT;\n\n$sprintf = array($comment->member->name, $comment->new->acpUrl(), $comment->new->title); $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'reply_action_split_away_from', ENT_DISALLOWED, 'UTF-8', FALSE ), FALSE, array( 'sprintf' => $sprintf ) );\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t\t<i class='fa fa-expand'><\/i> &nbsp;&nbsp;\nCONTENT;\n\n$sprintf = array($comment->member->name); $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'reply_action_split_away', ENT_DISALLOWED, 'UTF-8', FALSE ), FALSE, array( 'sprintf' => $sprintf ) );\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nelseif ( $comment->action === 'split_new' ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nif ( $comment->old ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t\t<i class='fa fa-expand'><\/i> &nbsp;&nbsp;\nCONTENT;\n\n$sprintf = array($comment->member->name, $comment->old->acpUrl(), $comment->old->title); $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'reply_action_split_new_to', ENT_DISALLOWED, 'UTF-8', FALSE ), FALSE, array( 'sprintf' => $sprintf ) );\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t\t<i class='fa fa-expand'><\/i> &nbsp;&nbsp;\nCONTENT;\n\n$sprintf = array($comment->member->name); $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'reply_action_split_new', ENT_DISALLOWED, 'UTF-8', FALSE ), FALSE, array( 'sprintf' => $sprintf ) );\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nelseif ( $comment->action === 'previous_request' ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nif ( $comment->old ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t\t<i class='fa fa-envelope-o'><\/i> &nbsp;&nbsp;\nCONTENT;\n\n$sprintf = array($comment->old->acpUrl(), $comment->old->title); $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'reply_action_previous_request', ENT_DISALLOWED, 'UTF-8', FALSE ), FALSE, array( 'sprintf' => $sprintf ) );\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nelseif ( $comment->new ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t\t<i class='fa fa-envelope-o'><\/i> &nbsp;&nbsp;\nCONTENT;\n\n$sprintf = array($comment->new->acpUrl(), $comment->new->title); $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'reply_action_previous_request_new', ENT_DISALLOWED, 'UTF-8', FALSE ), FALSE, array( 'sprintf' => $sprintf ) );\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t\t<i class='fa fa-envelope-o'><\/i> &nbsp;&nbsp;\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'reply_action_previous_request_none', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nelseif ( $comment->action === 'autoresolve_warning' ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t<i class='fa fa-tag'><\/i> &nbsp;&nbsp;\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'reply_action_autoresolve_warning', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nelseif ( $comment->action === 'autoresolve' ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t<i class='fa fa-tag'><\/i> &nbsp;&nbsp;\nCONTENT;\n\n$sprintf = array($comment->new ? $comment->new->_title : '?'); $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'reply_action_autoresolve', ENT_DISALLOWED, 'UTF-8', FALSE ), FALSE, array( 'sprintf' => $sprintf ) );\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nelseif ( $comment->action === 'merge' ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t<i class='fa fa-level-up'><\/i> &nbsp;&nbsp;\nCONTENT;\n\n$sprintf = array($comment->member->name); $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'reply_action_merge', ENT_DISALLOWED, 'UTF-8', FALSE ), FALSE, array( 'sprintf' => $sprintf ) );\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\n\t\t\t\t\t\t\t\t\t<span class='ipsType_light cNexusAdminSupportMessage_date'>\nCONTENT;\n\n$val = ( $comment->date instanceof \\IPS\\DateTime ) ? $comment->date : \\IPS\\DateTime::ts( $comment->date );$return .= $val->html();\n$return .= <<<CONTENT\n<\/span>\n\t\t\t\t\t\t\t\t<\/p>\n\t\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\nCONTENT;\n\nendforeach;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t<div class=\"ipsClearfix ipsJS_hide\" data-role=\"pageActionOptions\">\n\t\t\t\t\t\t\t<div class=\"ipsPos_right\">\n\t\t\t\t\t\t\t\t<select name=\"modaction\" data-role=\"moderationAction\">\n\t\t\t\t\t\t\t\t\t<option value=\"split\" data-icon=\"expand\">\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'split', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/option>\n\t\t\t\t\t\t\t\t\t<option value=\"delete\" data-icon=\"trash\">\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'delete', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/option>\n\t\t\t\t\t\t\t\t<\/select>\n\t\t\t\t\t\t\t\t<button type=\"submit\" class=\"ipsButton ipsButton_alternate ipsButton_verySmall\">\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'submit', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/button>\n\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t<\/div>\n\t\t\t\t\t<\/form>\n\t\t\t\t<\/div>\n\n\t\t\t\t\nCONTENT;\n\nif ( $request->commentPageCount() > 1 ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t<div class='ipsSpacer_top'>\n\t\t\t\t\t\t{$request->commentPagination( array(), 'pagination', NULL, $request->acpUrl() )}\n\t\t\t\t\t<\/div>\n\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t<\/div>\n\t\t<\/section>\n\n\t\t\nCONTENT;\n\n$previous = $request->nextPrevious( 1 );\n$return .= <<<CONTENT\n\n\t\t\nCONTENT;\n\n$next = $request->nextPrevious();\n$return .= <<<CONTENT\n\n\t\t\nCONTENT;\n\nif ( $next or $previous ):\n$return .= <<<CONTENT\n\n\t\t\t<hr class='ipsHr'>\n\t\t\t<nav class=\"ipsPager ipsPager_small ipsGrid ipsClearFix ipsList_inline ipsSpacer_top\">\n\t\t\t\t<div class=\"ipsGrid_span6 ipsPager_prev\">\n\t\t\t\t\t\nCONTENT;\n\nif ( $previous ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t<a href=\"\nCONTENT;\n$return .= htmlspecialchars( $previous->acpUrl(), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\" title=\"\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'keyboard_shortcut_prev_req', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\" data-ipsTooltip data-role=\"prevRequestLink\">\n\t\t\t\t\t\t\t<span class=\"ipsPager_type\">\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'prev_request', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/span>\n\t\t\t\t\t\t\t<span class=\"ipsPager_title ipsType_break ipsTruncate ipsTruncate_line\">\nCONTENT;\n$return .= htmlspecialchars( $previous->title, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n<\/span>\n\t\t\t\t\t\t<\/a>\n\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t<\/div>\n\t\t\t\t<div class=\"ipsGrid_span6 ipsType_right ipsPager_next\">\n\t\t\t\t\t\nCONTENT;\n\nif ( $next ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t<a href=\"\nCONTENT;\n$return .= htmlspecialchars( $next->acpUrl(), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\" title=\"\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'keyboard_shortcut_next_req', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\" data-ipsTooltip data-role=\"nextRequestLink\">\n\t\t\t\t\t\t\t<span class=\"ipsPager_type\">\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'next_request', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/span>\n\t\t\t\t\t\t\t<span class=\"ipsPager_title ipsType_break ipsTruncate ipsTruncate_line\">\nCONTENT;\n$return .= htmlspecialchars( $next->title, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n<\/span>\n\t\t\t\t\t\t<\/a>\n\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t<\/div>\n\t\t\t<\/nav>\n\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t<\/div>\n\t<div class='cWithInfoPanel_info cNexusSupportRequest_metaInfo'>\n\t\t<div id='elNexusRequestInfo'>\n\t\t\t\nCONTENT;\n\nif ( count( $requestActions ) ):\n$return .= <<<CONTENT\n\n\t\t\t\t<div id='elNexusRequestControls' class='ipsPad'  data-ipsSticky data-ipsSticky-spacing='60'>\n\t\t\t\t\t\nCONTENT;\n\n$return .= \\IPS\\Theme::i()->getTemplate( \"support\", \"nexus\" )->requestActions( $requestActions );\n$return .= <<<CONTENT\n\n\t\t\t\t<\/div>\n\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t<hr class='ipsHr'>\n\n\t\t\t<div class='ipsPad'>\n\t\t\t\t<div class=\"ipsBox ipsSpacer_bottom\">\n\t\t\t\t\t<h3 class='ipsBox_titleBar'>\n\t\t\t\t\t\t\nCONTENT;\n\nif ( $name = $request->supportAuthor()->name() ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\nCONTENT;\n$return .= htmlspecialchars( $name, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\nCONTENT;\n\nif ( $link = $request->supportAuthor()->url() ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t<a href=\"\nCONTENT;\n$return .= htmlspecialchars( $link, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\" class='ipsPos_right ipsType_medium'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'view_account', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a>\n\t\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t<\/h3>\n\t\t\t\t\t<div class='ipsPad ipsType_center'>\n\t\t\t\t\t\t\n\t\t\t\t\t\t\nCONTENT;\n\nif ( $photo = $request->supportAuthor()->photo() ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\nCONTENT;\n\nif ( $link = $request->supportAuthor()->url() ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t<a href=\"\nCONTENT;\n$return .= htmlspecialchars( $link, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\"><img src='\nCONTENT;\n$return .= htmlspecialchars( $photo, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n' class='ipsUserPhoto ipsUserPhoto_medium' alt=''><\/a>\n\t\t\t\t\t\t\t\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t<img src='\nCONTENT;\n$return .= htmlspecialchars( $photo, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n' class='ipsUserPhoto ipsUserPhoto_medium'>\n\t\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t<hr class='ipsHr'>\n\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\n\t\t\t\t\t\t\nCONTENT;\n\nif ( $meta = $request->supportAuthor()->meta() ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t<ul class='ipsList_reset ipsType_medium'>\n\t\t\t\t\t\t\t\t\nCONTENT;\n\nforeach ( $meta as $meta ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t<li>\nCONTENT;\n$return .= htmlspecialchars( $meta, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n<\/li>\n\t\t\t\t\t\t\t\t\nCONTENT;\n\nendforeach;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t<\/ul>\n\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\n\t\t\t\t\t\t\nCONTENT;\n\nif ( \\IPS\\Member::loggedIn()->hasAcpRestriction( 'nexus', 'customers', 'customer_notes_view' ) and $request->member ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t<hr class='ipsHr'>\n\t\t\t\t\t\t\t<p class='ipsType_reset ipsType_medium'>\n\t\t\t\t\t\t\t\t\nCONTENT;\n\nif ( $noteCount = $request->supportAuthor()->noteCount() ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t<strong><a href='\nCONTENT;\n\n$return .= str_replace( '&', '&amp;', \\IPS\\Http\\Url::internal( \"app=core&module=members&controller=members&do=lazyBlock&block=IPS\\\\nexus\\\\extensions\\\\core\\\\MemberACPProfileBlocks\\\\Notes&id={$request->member}&support={$request->id}\", null, \"\", array(), 0 ) );\n$return .= <<<CONTENT\n' data-ipsDialog data-ipsDialog-title=\"\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'customer_notes', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\">\nCONTENT;\n\n$pluralize = array( $noteCount ); $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'num_customer_notes', ENT_DISALLOWED, 'UTF-8', FALSE ), FALSE, array( 'pluralize' => $pluralize ) );\n$return .= <<<CONTENT\n<\/a><\/strong>\n\t\t\t\t\t\t\t\t\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\nCONTENT;\n\n$pluralize = array( 0 ); $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'num_customer_notes', ENT_DISALLOWED, 'UTF-8', FALSE ), FALSE, array( 'pluralize' => $pluralize ) );\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\nCONTENT;\n\nif ( \\IPS\\Member::loggedIn()->hasAcpRestriction( 'nexus', 'customers', 'customer_notes_add' ) ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t&nbsp;&nbsp;<a href='\nCONTENT;\n\n$return .= str_replace( '&', '&amp;', \\IPS\\Http\\Url::internal( \"app=nexus&module=customers&controller=view&id={$request->member}&do=noteForm&support={$request->id}\", null, \"\", array(), 0 ) );\n$return .= <<<CONTENT\n' data-ipsDialog data-ipsDialog-title=\"\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'add_note', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\">\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'add_note', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a>\n\t\t\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t<\/p>\n\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\n\t\t\t\t\t\t\nCONTENT;\n\nif ( ( $request->member && \\IPS\\Member::loggedIn()->hasAcpRestriction( 'core', 'members', 'member_login' ) AND !\\IPS\\Member::load( $request->member )->isBanned() ) ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t<p class='ipsType_reset ipsType_medium'>\n\t\t\t\t\t\t\t\t<a href='\nCONTENT;\n\n$return .= str_replace( '&', '&amp;', \\IPS\\Http\\Url::internal( \"app=core&module=members&controller=members&do=login&id={$request->member}\", null, \"\", array(), 0 ) );\n$return .= <<<CONTENT\n' target='_blank'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'sign_in_as_customer', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a>\n\t\t\t\t\t\t\t<\/p>\n\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t<\/div>\t\n\t\t\t\t\n\t\t\t\t\t\nCONTENT;\n\n$otherRequests = $request->supportAuthor()->supportRequests( 10, $request );\n$return .= <<<CONTENT\n\n\t\t\t\t\t\nCONTENT;\n\n$invoices = \\IPS\\Member::loggedIn()->hasAcpRestriction( 'nexus', 'payments', 'invoices_manage' ) ? $request->supportAuthor()->invoices() : NULL;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\n\t\t\t\t\t\nCONTENT;\n\nif ( ( $otherRequests and $otherRequests->count() ) or ( $invoices and $invoices->count() ) ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\nCONTENT;\n\nif ( ( $otherRequests and $otherRequests->count() ) and ( $invoices and $invoices->count() ) ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t<div class=\"ipsTabs ipsTabs_small ipsTabs_stretch ipsClearfix ipsSpacer_top\" id=\"elRequestMeta\" data-ipsTabBar data-ipsTabBar-contentArea=\"#elRequestMeta_content\">\n\t\t\t\t\t\t\t\t<a href=\"#elRequestMeta\" data-action=\"expandTabs\"><i class=\"fa fa-caret-down\"><\/i><\/a>\n\t\t\t\t\t\t\t\t<ul role=\"tablist\">\n\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nif ( $otherRequests and count( $otherRequests ) ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t\t\t\t\t<a href='#' id='elRequestHistory' class='ipsTabs_item ipsType_center' data-role='noteTab' role=\"tab\" aria-selected=\"false\">\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'support_info_requests', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n (\nCONTENT;\n$return .= htmlspecialchars( $otherRequests->count(TRUE), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n)<\/a>\n\t\t\t\t\t\t\t\t\t\t<\/li>\n\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nif ( $invoices and count( $invoices ) ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t\t\t\t\t<a href='#' id='elInvoiceHistory' class='ipsTabs_item ipsType_center' data-role='noteTab' role=\"tab\" aria-selected=\"false\">\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'support_info_invoices', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n (\nCONTENT;\n$return .= htmlspecialchars( $invoices->count(TRUE), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n)<\/a>\n\t\t\t\t\t\t\t\t\t\t<\/li>\n\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t<\/ul>\n\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t<div id=\"elRequestMeta_content\" class=\"ipsTabs_panels ipsClearfix\">\n\t\t\t\t\t\t\t\nCONTENT;\n\nif ( $otherRequests ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t<div id=\"ipsTabs_elRequestMeta_elRequestHistory_panel\" class=\"ipsTabs_panel ipsPad ipsAreaBackground_reset ipsClearfix\" aria-hidden=\"false\">\n\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nif ( !$invoices or !$invoices->count() ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t<h2 class=\"ipsType_sectionHead ipsType_large\">\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'support_info_requests', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/h2>\n\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t<ul class='ipsDataList ipsDataList_reducedSpacing ipsList_reset'>\n\t\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nforeach ( $otherRequests as $otherRequest ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t\t<li class='ipsDataItem'>\n\t\t\t\t\t\t\t\t\t\t\t\t<div class='ipsDataItem_main ipsType_blendLinks'>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\nCONTENT;\n\n$return .= \\IPS\\Theme::i()->getTemplate( \"support\", \"nexus\" )->status( \\IPS\\nexus\\Support\\Status::load( $otherRequest->status->id ), 'ipsPos_right' );\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t<a href=\"\nCONTENT;\n$return .= htmlspecialchars( $otherRequest->acpUrl(), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\" data-ipsDialog data-ipsDialog-title=\"\nCONTENT;\n$return .= htmlspecialchars( $otherRequest->title, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n (#\nCONTENT;\n$return .= htmlspecialchars( $otherRequest->id, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n)\" data-ipsDialog-url=\"\nCONTENT;\n$return .= htmlspecialchars( $otherRequest->acpUrl()->setQueryString( 'popup', $request->id ), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\" class='ipsDataItem_title'>\nCONTENT;\n$return .= htmlspecialchars( $otherRequest->title, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n<\/a>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<p class='ipsDataItem_meta ipsType_reset ipsType_small ipsType_light'>#\nCONTENT;\n$return .= htmlspecialchars( $otherRequest->id, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n &nbsp;&nbsp;&nbsp; \nCONTENT;\n\n$val = ( $otherRequest->mapped('date') instanceof \\IPS\\DateTime ) ? $otherRequest->mapped('date') : \\IPS\\DateTime::ts( $otherRequest->mapped('date') );$return .= $val->html();\n$return .= <<<CONTENT\n<\/p>\n\t\t\t\t\t\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t\t\t\t\t\t<\/li>\n\t\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nendforeach;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t<\/ul>\n\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nif ( $otherRequests->count( TRUE ) > 10 ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t<div class=\"ipsType_center\">\n\t\t\t\t\t\t\t\t\t\t\t<a href=\"\nCONTENT;\n\n$return .= str_replace( '&', '&amp;', \\IPS\\Http\\Url::internal( \"app=nexus&module=support&controller=requests&member={$request->member}\", null, \"\", array(), 0 ) );\n$return .= <<<CONTENT\n\" class=\"ipsButton ipsButton_verySmall ipsButton_normal\">\nCONTENT;\n\n$pluralize = array( $otherRequests->count(TRUE) ); $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'see_all_support', ENT_DISALLOWED, 'UTF-8', FALSE ), FALSE, array( 'pluralize' => $pluralize ) );\n$return .= <<<CONTENT\n<\/a>\n\t\t\t\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\nCONTENT;\n\nif ( \\IPS\\Member::loggedIn()->hasAcpRestriction( 'nexus', 'payments', 'invoices_manage' ) and $invoices ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t<div id=\"ipsTabs_elRequestMeta_elInvoiceHistory_panel\" class=\"ipsTabs_panel ipsPad_half ipsAreaBackground_reset ipsClearfix\" aria-hidden=\"false\">\n\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nif ( !$otherRequests or !$otherRequests->count() ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t<h2 class=\"ipsType_sectionHead ipsType_large\">\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'support_info_invoices', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/h2>\n\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t<ul class='ipsDataList'>\n\t\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nforeach ( $invoices as $invoice ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t\t<li class='ipsDataItem'>\n\t\t\t\t\t\t\t\t\t\t\t\t<div class='ipsDataItem_main ipsType_blendLinks'>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<p class='ipsType_reset ipsType_normal'>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<a href=\"\nCONTENT;\n$return .= htmlspecialchars( $invoice->acpUrl(), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\"><span class='ipsType_light ipsType_medium'>#\nCONTENT;\n$return .= htmlspecialchars( $invoice->id, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n<\/span> \nCONTENT;\n$return .= htmlspecialchars( $invoice->title, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n<\/a>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<\/p>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<p class='ipsType_reset ipsType_medium'>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\nCONTENT;\n\n$return .= \\IPS\\Theme::i()->getTemplate( \"invoices\", \\IPS\\Request::i()->app )->status( $invoice->status );\n$return .= <<<CONTENT\n &nbsp;&nbsp;<strong>\nCONTENT;\n$return .= htmlspecialchars( $invoice->total, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n<\/strong> &nbsp;&nbsp;<span class='ipsType_light'>\nCONTENT;\n\n$val = ( $invoice->date instanceof \\IPS\\DateTime ) ? $invoice->date : \\IPS\\DateTime::ts( $invoice->date );$return .= $val->html();\n$return .= <<<CONTENT\n<\/span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<\/p>\n\t\t\t\t\t\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t\t\t\t\t\t<\/li>\n\t\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nendforeach;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t<\/ul>\n\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nif ( $invoices->count(TRUE) > 10 ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t<div class=\"ipsType_center\">\n\t\t\t\t\t\t\t\t\t\t\t<a href=\"\nCONTENT;\n\n$return .= str_replace( '&', '&amp;', \\IPS\\Http\\Url::internal( \"app=nexus&module=customers&controller=view&id={$request->member}&tab=invoices\", null, \"\", array(), 0 ) );\n$return .= <<<CONTENT\n\" class=\"ipsButton ipsButton_verySmall ipsButton_normal\">\nCONTENT;\n\n$pluralize = array( $invoices->count(TRUE) ); $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'see_all_invoices', ENT_DISALLOWED, 'UTF-8', FALSE ), FALSE, array( 'pluralize' => $pluralize ) );\n$return .= <<<CONTENT\n<\/a>\n\t\t\t\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t<\/div>\n\n\t\t\t\t\nCONTENT;\n\nif ( $customFields = $request->department->customFields() ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\nCONTENT;\n\n$customFieldValues = $request->cfields;\n$return .= <<<CONTENT\n\n\t\t\t\t\t<div class=\"ipsBox ipsSpacer_bottom\">\n\t\t\t\t\t\t<h2 class=\"ipsBox_titleBar\">\n\t\t\t\t\t\t\t\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'support_additional_info', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t<\/h2>\n\t\t\t\t\t\t&nbsp;&nbsp;<a href=\"\nCONTENT;\n$return .= htmlspecialchars( $request->acpUrl()->setQueryString( 'do', 'cfields' ), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\" data-ipsDialog data-ipsDialog-title=\"\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'custom_support_fields', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\" class=\"ipsType_small\">(\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'edit', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n)<\/a>\n\t\t\t\t\t\t<ul class='ipsList_reset ipsSpacer_top'>\n\t\t\t\t\t\t\t\nCONTENT;\n\nforeach ( $customFields as $field ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t<li class='ipsSpacer_bottom ipsSpacer_half'>\n\t\t\t\t\t\t\t\t\t<h4 class='ipsType_minorHeading'>\nCONTENT;\n$return .= htmlspecialchars( $field->_title, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n<\/h4>\n\t\t\t\t\t\t\t\t\t<div class='ipsType_richText ipsType_medium ipsContained ipsType_break'>\n\t\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nif ( isset( $customFieldValues[ $field->id ] ) AND ( $customFieldValues[ $field->id ] OR $customFieldValues[ $field->id ] == '0' ) ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t\t{$field->displayValue( $customFieldValues[ $field->id ], TRUE )}\n\t\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t\t<em class=\"ipsType_light\">\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'no_value', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/em>\n\t\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t\t\t<\/li>\n\t\t\t\t\t\t\t\nCONTENT;\n\nendforeach;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t<\/ul>\n\t\t\t\t\t<\/div>\n\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\n\t\t\t\t\nCONTENT;\n\nif ( $ppiInvoice = $request->ppi_invoice ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t<div class=\"ipsBox ipsSpacer_bottom\">\n\t\t\t\t\t\t<h2 class=\"ipsBox_titleBar\">\n\t\t\t\t\t\t\t\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'ppi_invoice', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t<\/h2>\n\t\t\t\t\t\t&nbsp;&nbsp;<a href=\"\nCONTENT;\n$return .= htmlspecialchars( $ppiInvoice->acpUrl(), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\" class=\"ipsType_small\">(\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'view', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n)<\/a>\n\t\t\t\t\t\t\nCONTENT;\n\n$summary = $ppiInvoice->summary();\n$return .= <<<CONTENT\n\n\n\t\t\t\t\t\t<ul class='ipsDataList ipsDataList_reducedSpacing ipsSpacer_top ipsSpacer_half ipsPad_half'>\n\t\t\t\t\t\t\t\nCONTENT;\n\nforeach ( $summary['items'] as $item ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\nCONTENT;\n\nif ( !( $item instanceof \\IPS\\nexus\\extensions\\nexus\\Item\\CouponDiscount ) ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t<li class='ipsDataItem'>\n\t\t\t\t\t\t\t\t\t\t<div class='ipsDataItem_main ipsType_break ipsContained'>\n\t\t\t\t\t\t\t\t\t\t\t<span class='ipsType_medium'>\n\t\t\t\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nif ( $item->quantity > 1 ):\n$return .= <<<CONTENT\n<span class='ipsType_light'>\nCONTENT;\n$return .= htmlspecialchars( $item->quantity, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n x <\/span>\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t\t\t\nCONTENT;\n$return .= htmlspecialchars( $item->name, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t\t<\/span>\n\t\t\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nif ( count( $item->details ) ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t\t\t<br>\n\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"ipsType_light\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nforeach ( $item->details as $k => $v ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\nCONTENT;\n\n$val = \"nexus_pfield_{$k}\"; $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( $val, ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n: \nCONTENT;\n$return .= htmlspecialchars( $v, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n<br>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nendforeach;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t\t\t<\/span>\n\t\t\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t\t\t\t\t<div class='ipsDataItem_generic ipsDataItem_size3 ipsType_right'>\n\t\t\t\t\t\t\t\t\t\t\t<span class='cNexusPrice ipsType_normal'>\nCONTENT;\n$return .= htmlspecialchars( $item->linePrice(), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n<\/span>\n\t\t\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nif ( $item->quantity > 1 ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t\t\t<p class='ipsType_reset ipsType_small ipsType_light'>\nCONTENT;\n\n$sprintf = array($item->price); $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'each_short', ENT_DISALLOWED, 'UTF-8', FALSE ), FALSE, array( 'sprintf' => $sprintf ) );\n$return .= <<<CONTENT\n<\/p>\n\t\t\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t\t\t\t<\/li>\n\t\t\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\nCONTENT;\n\nendforeach;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\nCONTENT;\n\nforeach ( $summary['items'] as $item ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\nCONTENT;\n\nif ( $item instanceof \\IPS\\nexus\\extensions\\nexus\\Item\\CouponDiscount ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t<li class='ipsDataItem cNexusCheckout_coupon'>\n\t\t\t\t\t\t\t\t\t\t<div class='ipsDataItem_main ipsType_right'>\n\t\t\t\t\t\t\t\t\t\t\t<strong>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'coupon', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/strong>\n\t\t\t\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t\t\t\t\t<div class='ipsDataItem_generic ipsDataItem_size3 ipsType_right cNexusPrice'>\n\t\t\t\t\t\t\t\t\t\t\t\nCONTENT;\n$return .= htmlspecialchars( $item->linePrice(), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t\t\t\t<\/li>\n\t\t\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\nCONTENT;\n\nendforeach;\n$return .= <<<CONTENT\n\t\n\t\t\t\t\t\t\t<li class='ipsDataItem cNexusCheckout_subtotal'>\n\t\t\t\t\t\t\t\t<div class='ipsDataItem_main ipsType_right'>\n\t\t\t\t\t\t\t\t\t<strong>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'subtotal', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/strong>\n\t\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t\t\t<div class='ipsDataItem_generic ipsDataItem_size3 ipsType_right cNexusPrice'>\n\t\t\t\t\t\t\t\t\t\nCONTENT;\n$return .= htmlspecialchars( $summary['subtotal'], ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t\t<\/li>\n\t\t\t\t\t\t\t\nCONTENT;\n\nforeach ( $summary['tax'] as $tax ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t<li class='ipsDataItem'>\n\t\t\t\t\t\t\t\t\t<div class='ipsDataItem_main ipsType_right'>\n\t\t\t\t\t\t\t\t\t\t<strong>\nCONTENT;\n$return .= htmlspecialchars( $tax['name'], ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n <span class='ipsType_light ipsType_unbold'>(\nCONTENT;\n\n$return .= htmlspecialchars( $tax['rate']*100, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n%)<\/span><\/strong>\n\t\t\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t\t\t\t<div class='ipsDataItem_generic ipsDataItem_size3 ipsType_right cNexusPrice'>\n\t\t\t\t\t\t\t\t\t\t\nCONTENT;\n$return .= htmlspecialchars( $tax['amount'], ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t\t\t<\/li>\n\t\t\t\t\t\t\t\nCONTENT;\n\nendforeach;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t<li class='ipsDataItem ipsType_large cNexusCheckout_subtotal'>\n\t\t\t\t\t\t\t\t<div class='ipsDataItem_main ipsType_right'>\n\t\t\t\t\t\t\t\t\t<strong>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'total', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/strong>\n\t\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t\t\t<div class='ipsDataItem_generic ipsDataItem_size3 ipsType_right cNexusPrice'>\n\t\t\t\t\t\t\t\t\t<strong>\nCONTENT;\n$return .= htmlspecialchars( $summary['total'], ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n<\/strong>\n\t\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t\t<\/li>\n\t\t\t\t\t\t<\/ul>\n\t\t\t\t\t<\/div>\n\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\n\t\t\t\t<div class=\"ipsBox\">\n\t\t\t\t\t<h2 class=\"ipsBox_titleBar\">\n\t\t\t\t\t\t\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'viewed_by', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\n\t\t\t\t\t<\/h2>\n\t\t\t\t\t\nCONTENT;\n\nforeach ( $request->staffViews() as $view ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t<div class='ipsPad ipsPhotoPanel ipsPhotoPanel_tiny ipsClearfix'>\n\t\t\t\t\t\t\t<img src='\nCONTENT;\n\n$return .= htmlspecialchars( \\IPS\\Member::load( $view['view_member'] )->photo, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n' class='ipsUserPhoto ipsUserPhoto_tiny ipsPos_left' alt=''>\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<strong>\nCONTENT;\n\n$return .= htmlspecialchars( \\IPS\\Member::load( $view['view_member'] )->name, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n<\/strong>\n\n\t\t\t\t\t\t\t\t<ul class='ipsList_inline ipsType_small'>\n\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nif ( $view['view_reply'] ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t<li><i class='fa fa-mail-reply'><\/i> \nCONTENT;\n\n$val = ( $view['view_reply'] instanceof \\IPS\\DateTime ) ? $view['view_reply'] : \\IPS\\DateTime::ts( $view['view_reply'] );$return .= $val->html();\n$return .= <<<CONTENT\n<\/li>\n\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t<li \nCONTENT;\n\nif ( $view['view_last'] !== $view['view_first'] ):\n$return .= <<<CONTENT\ndata-ipsTooltip title=\"\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'view_first', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n \nCONTENT;\n\n$val = ( $view['view_first'] instanceof \\IPS\\DateTime ) ? $view['view_first'] : \\IPS\\DateTime::ts( $view['view_first'] );$return .= (string) $val;\n$return .= <<<CONTENT\n\"\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n><i class='fa fa-eye'><\/i> \nCONTENT;\n\n$val = ( $view['view_last'] instanceof \\IPS\\DateTime ) ? $view['view_last'] : \\IPS\\DateTime::ts( $view['view_last'] );$return .= $val->html();\n$return .= <<<CONTENT\n<\/li>\n\t\t\t\t\t\t\t\t<\/ul>\n\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\nCONTENT;\n\nendforeach;\n$return .= <<<CONTENT\n\n\t\t\t\t<\/div>\n\t\t\t<\/div>\n\t\t<\/div>\n\t<\/div>\n<\/div>\nCONTENT;\n\n\t\treturn $return;\n}\n\n\tfunction requestActions( $actions ) {\n\t\t$return = '';\n\t\t$return .= <<<CONTENT\n\n\n<ul class='ipsList_reset'>\n\t\nCONTENT;\n\nforeach ( $actions as $action ):\n$return .= <<<CONTENT\n\n\t\t<li>\n\t\t\t<a href='#' class='ipsType_blendLinks' \nCONTENT;\n\nif ( isset( $action['menu'] ) ):\n$return .= <<<CONTENT\ndata-ipsMenu id='\nCONTENT;\n\n$id = mt_rand();\n$return .= <<<CONTENT\n\nCONTENT;\n$return .= htmlspecialchars( $id, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n'\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n \nCONTENT;\n\nif ( isset( $action['data'] ) ):\n$return .= <<<CONTENT\n\nCONTENT;\n\nforeach ( $action['data'] as $k => $v ):\n$return .= <<<CONTENT\ndata-\nCONTENT;\n$return .= htmlspecialchars( $k, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n=\"\nCONTENT;\n$return .= htmlspecialchars( $v, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\" \nCONTENT;\n\nendforeach;\n$return .= <<<CONTENT\n\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n>\n\t\t\t\t<h3 class='ipsType_minorHeading'>\nCONTENT;\n$return .= htmlspecialchars( $action['tooltip'], ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n<\/h3>\n\t\t\t\t<p class='ipsType_reset cNexusSupportStatus_value ipsTruncate ipsTruncate_line'><span data-role=\"title\">\nCONTENT;\n\n$val = \"{$action['title']}\"; $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( $val, ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/span><\/p>\n\t\t\t<\/a>\n\t\t\t\nCONTENT;\n\nif ( isset( $action['menu'] ) ):\n$return .= <<<CONTENT\n\n\t\t\t\t<div id='\nCONTENT;\n$return .= htmlspecialchars( $id, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n_menu' class='ipsMenu \nCONTENT;\n\nif ( isset( $action['menuClass'] ) ):\n$return .= <<<CONTENT\n\nCONTENT;\n$return .= htmlspecialchars( $action['menuClass'], ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n ipsHide'>\n\t\t\t\t\t<ul>\n\t\t\t\t\t\t\nCONTENT;\n\nforeach ( $action['menu'] as $item ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\nCONTENT;\n\nif ( isset( $item['hr'] ) and $item['hr'] ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t<li class='ipsMenu_sep'><hr><\/li>\n\t\t\t\t\t\t\t\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t<li class=\"ipsMenu_item \nCONTENT;\n\nif ( isset( $item['class'] ) ):\n$return .= <<<CONTENT\n\nCONTENT;\n$return .= htmlspecialchars( $item['class'], ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\" \nCONTENT;\n\nif ( isset( $item['data'] ) ):\n$return .= <<<CONTENT\n\nCONTENT;\n\nforeach ( $item['data'] as $k => $v ):\n$return .= <<<CONTENT\n data-\nCONTENT;\n$return .= htmlspecialchars( $k, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n=\"\nCONTENT;\n$return .= htmlspecialchars( $v, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\"\nCONTENT;\n\nendforeach;\n$return .= <<<CONTENT\n\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n>\n\t\t\t\t\t\t\t\t\t<a href=\"\nCONTENT;\n$return .= htmlspecialchars( $item['link'], ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\">\n\t\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nif ( isset( $item['icon'] ) ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t\t<i class='fa fa-\nCONTENT;\n$return .= htmlspecialchars( $item['icon'], ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n'><\/i> &nbsp;&nbsp;\n\t\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t<span data-role=\"title\">\nCONTENT;\n\n$val = \"{$item['title']}\"; $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( $val, ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/span>\n\t\t\t\t\t\t\t\t\t<\/a>\n\t\t\t\t\t\t\t\t<\/li>\n\t\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\nCONTENT;\n\nendforeach;\n$return .= <<<CONTENT\n\n\t\t\t\t\t<\/ul>\n\t\t\t\t<\/div>\n\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t<\/li>\n\t\nCONTENT;\n\nendforeach;\n$return .= <<<CONTENT\n\n<\/ul>\nCONTENT;\n\n\t\treturn $return;\n}\n\n\tfunction requestHeader( $request ) {\n\t\t$return = '';\n\t\t$return .= <<<CONTENT\n\n\n<div id='acpPageHeader'>\n\t\nCONTENT;\n\n$return .= \\IPS\\Theme::i()->getTemplate( \"global\", \"core\", 'admin' )->breadcrumb(  );\n$return .= <<<CONTENT\n\n\n\t<h1 class='ipsType_pageTitle cNexusSupportRequest_title'>\n\t\t\nCONTENT;\n$return .= htmlspecialchars( $request->title, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n \n\t\t<span class=\"ipsType_normal ipsType_light\">#\nCONTENT;\n$return .= htmlspecialchars( $request->id, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n<\/span> <a href='\nCONTENT;\n$return .= htmlspecialchars( $request->acpUrl()->setQueryString( 'do', 'editTitle' ), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n' class='ipsType_normal ipsFaded ipsFaded_more' data-ipsDialog data-ipsDialog-title=\"\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'edit_support_request_title', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\">(\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'edit', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n)<\/a>\n\t<\/h1>\n\n\t<hr class='ipsHr'>\n\n\t<div class='acpPageHeader_flex'>\n\t\t<ul class='ipsList_inline ipsType_reset ipsType_medium'>\n\t\t\t<li \nCONTENT;\n\nif ( !$request->severity or $request->severity->color == '000' ):\n$return .= <<<CONTENT\nclass=\"ipsHide\"\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n data-role=\"requestSeverityBadge\">\n\t\t\t\t\nCONTENT;\n\nif ( $request->severity and $request->severity->color != '000' ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\nCONTENT;\n\n$return .= \\IPS\\Theme::i()->getTemplate( \"support\", \\IPS\\Request::i()->app )->severity( $request->severity );\n$return .= <<<CONTENT\n\n\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t<\/li>\n\t\t\t<li data-role=\"requestStatusBadge\">\nCONTENT;\n\n$return .= \\IPS\\Theme::i()->getTemplate( \"support\", \\IPS\\Request::i()->app )->status( $request->status );\n$return .= <<<CONTENT\n<\/li>\n\t\t\t<li class='ipsType_light'><i class='fa fa-clock-o'><\/i> \nCONTENT;\n\n$sprintf = array(\\IPS\\DateTime::formatInterval( \\IPS\\DateTime::ts( $request->mapped('date') )->diff( new \\IPS\\DateTime ), 2 )); $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'request_created_ago', ENT_DISALLOWED, 'UTF-8', FALSE ), FALSE, array( 'sprintf' => $sprintf ) );\n$return .= <<<CONTENT\n<\/li>\n\t\t\t<li \nCONTENT;\n\nif ( !$request->staff ):\n$return .= <<<CONTENT\nclass=\"ipsHide\"\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n data-role=\"requestAssignedToBadge\">\n\t\t\t\t<strong class='ipsType_success' data-role=\"requestAssignedToText\">\n\t\t\t\t\t\nCONTENT;\n\nif ( $request->staff ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\nCONTENT;\n\n$sprintf = array(( $request->staff->member_id === \\IPS\\Member::loggedIn()->member_id ) ? \\IPS\\Member::loggedIn()->language()->addToStack('you') : $request->staff->name); $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'assigned_to_x', ENT_DISALLOWED, 'UTF-8', FALSE ), FALSE, array( 'sprintf' => $sprintf ) );\n$return .= <<<CONTENT\n\n\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t<\/strong>\n\t\t\t<\/li>\n\t\t<\/ul>\n\n\t\t\nCONTENT;\n\nif ( isset(\\IPS\\Output::i()->sidebar['actions']) ):\n$return .= <<<CONTENT\n\n\t\t\t<div class='acpToolbar ipsPos_right ipsClearfix'>\n\t\t\t\t\nCONTENT;\n\n$return .= \\IPS\\Theme::i()->getTemplate( \"global\", \"core\", 'admin' )->pageButtons( \\IPS\\Output::i()->sidebar['actions'] );\n$return .= <<<CONTENT\n\n\t\t\t<\/div>\n\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t<\/div>\n<\/div>\nCONTENT;\n\n\t\treturn $return;\n}\n\n\tfunction requestHover( $request, $overviews ) {\n\t\t$return = '';\n\t\t$return .= <<<CONTENT\n\n\n<div>\n\t\nCONTENT;\n\nif ( count( $overviews ) > 1 ):\n$return .= <<<CONTENT\n\n\t\t<div class=\"ipsTabs ipsTabs_small ipsTabs_container ipsClearfix\" id=\"elSupportRequest_\nCONTENT;\n$return .= htmlspecialchars( $request->id, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\" data-ipsTabBar data-ipsTabBar-contentarea=\"#elSupportRequest_\nCONTENT;\n$return .= htmlspecialchars( $request->id, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n_content\">\n\t\t\t<a href=\"#elSupportRequest_\nCONTENT;\n$return .= htmlspecialchars( $request->id, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\" data-action=\"expandTabs\"><i class=\"fa fa-caret-down\"><\/i><\/a>\n\t\t\t<ul role=\"tablist\">\n\t\t\t\t\nCONTENT;\n\nforeach ( $overviews as $tabID => $tabData ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t<li>\n\t\t\t\t\t\t<a href=\"#ipsTabs_elSupportRequest_\nCONTENT;\n$return .= htmlspecialchars( $request->id, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n_elSupportRequest_\nCONTENT;\n$return .= htmlspecialchars( $request->id, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n_\nCONTENT;\n$return .= htmlspecialchars( $tabID, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n_panel\" id=\"elSupportRequest_\nCONTENT;\n$return .= htmlspecialchars( $request->id, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n_\nCONTENT;\n$return .= htmlspecialchars( $tabID, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\" class=\"ipsTabs_item ipsType_center\" role=\"tab\" aria-selected=\"\nCONTENT;\n\nif ( $tabID == 'firstMessage' ):\n$return .= <<<CONTENT\ntrue\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\nfalse\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\">\nCONTENT;\n\n$val = \"{$tabData[0]}\"; $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( $val, ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a>\n\t\t\t\t\t<\/li>\n\t\t\t\t\nCONTENT;\n\nendforeach;\n$return .= <<<CONTENT\n\n\t\t\t<\/ul>\n\t\t<\/div>\n\t\t<div id='elSupportRequest_\nCONTENT;\n$return .= htmlspecialchars( $request->id, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n_content' class='ipsTabs_panels ipsTabs_contained ipsScrollbar'>\n\t\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n\t\t<div class='ipsPad ipsScrollbar'>\n\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\n\t\t\nCONTENT;\n\nforeach ( $overviews as $tabID => $tabData ):\n$return .= <<<CONTENT\n\n\t\t\t\nCONTENT;\n\nif ( count( $overviews ) > 1 ):\n$return .= <<<CONTENT\n\n\t\t\t\t<div id='ipsTabs_elSupportRequest_\nCONTENT;\n$return .= htmlspecialchars( $request->id, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n_elSupportRequest_\nCONTENT;\n$return .= htmlspecialchars( $request->id, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n_\nCONTENT;\n$return .= htmlspecialchars( $tabID, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n_panel' class='ipsTabs_panel'>\n\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\nCONTENT;\n\n$return .= \\IPS\\Theme::i()->getTemplate( \"support\", \\IPS\\Request::i()->app )->replyContainer( $request, $tabData[1], TRUE );\n$return .= <<<CONTENT\n\n\t\t\t\nCONTENT;\n\nif ( count( $overviews ) > 1 ):\n$return .= <<<CONTENT\n\n\t\t\t\t<\/div>\n\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\nCONTENT;\n\nendforeach;\n$return .= <<<CONTENT\n\n\t<\/div>\n<\/div>\nCONTENT;\n\n\t\treturn $return;\n}\n\n\tfunction requestPopup( $request ) {\n\t\t$return = '';\n\t\t$return .= <<<CONTENT\n\n<div class=\"ipsPad\">\n\t<div class=\"ipsClearfix\">\n\t\t<ul class=\"ipsList ipsList_inline ipsPos_left\">\n\t\t\t<li>\n\t\t\t\t<a href=\"\nCONTENT;\n$return .= htmlspecialchars( $request->acpUrl(), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\" class=\"ipsButton ipsButton_verySmall ipsButton_normal\"><i class=\"fa fa-search\"><\/i> \nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'view', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a>\n\t\t\t<\/li>\n\t\t\t\nCONTENT;\n\nif ( \\IPS\\Member::loggedIn()->hasAcpRestriction( 'nexus', 'support', 'requests_merge' ) ):\n$return .= <<<CONTENT\n\n\t\t\t\t<li>\n\t\t\t\t\t<a href=\"\nCONTENT;\n$return .= htmlspecialchars( $request->acpUrl()->setQueryString( array( 'do' => 'merge', 'merge' => \\IPS\\Request::i()->popup ) ), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\" class=\"ipsButton ipsButton_verySmall ipsButton_normal\"><i class=\"fa fa-level-up\"><\/i> \nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'merge', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a>\n\t\t\t\t<\/li>\n\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t<\/ul>\n\t\t<ul class=\"ipsList ipsList_inline ipsPos_right ipsPad_half\">\n\t\t\t<li><i class=\"fa fa-tag\"><\/i> \nCONTENT;\n$return .= htmlspecialchars( $request->status->_title, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n<\/li>\n\t\t\t\nCONTENT;\n\nif ( count( \\IPS\\nexus\\Support\\Severity::roots() ) > 1 ):\n$return .= <<<CONTENT\n\n\t\t\t\t<li><i class=\"fa fa-exclamation\"><\/i> \nCONTENT;\n$return .= htmlspecialchars( $request->severity->_title, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n<\/li>\n\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t<li><i class=\"fa fa-folder\"><\/i> \nCONTENT;\n$return .= htmlspecialchars( $request->department->_title, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n<\/li>\n\t\t\t<li><i class=\"fa fa-user\"><\/i> \nCONTENT;\n\nif ( $staff = $request->staf ):\n$return .= <<<CONTENT\n\nCONTENT;\n$return .= htmlspecialchars( $staff->name, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'unassigned', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n<\/li>\n\t\t<\/ul>\n\t<\/div>\n\t<br>\n\t<div>\n\t\t\nCONTENT;\n\nforeach ( $request->comments() as $comment ):\n$return .= <<<CONTENT\n\n\t\t\t{$comment->html()}\n\t\t\nCONTENT;\n\nendforeach;\n$return .= <<<CONTENT\n\n\t\t\nCONTENT;\n\nif ( $request->commentPageCount() > 1 ):\n$return .= <<<CONTENT\n\n\t\t\t<a href=\"\nCONTENT;\n$return .= htmlspecialchars( $request->acpUrl(), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\">\nCONTENT;\n\n$pluralize = array( ( $request->mapped('num_comments') - $request::getCommentsPerPage() ) ); $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'x_more_messages', ENT_DISALLOWED, 'UTF-8', FALSE ), FALSE, array( 'pluralize' => $pluralize ) );\n$return .= <<<CONTENT\n<\/a>\n\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t<\/div>\n<\/div>\nCONTENT;\n\n\t\treturn $return;\n}\n\n\tfunction requests( $form, $stream, $results, $pagination, $groupByDepartment, $sortBy, $sortDir, $tracked, $participatedIn, $honorSeverities=TRUE ) {\n\t\t$return = '';\n\t\t$return .= <<<CONTENT\n\n\n<div data-controller='nexus.admin.support.list' class='ipsBox ipsClearfix'>\n\t<noscript>\n\t\t<p class=\"ipsType_reset ipsType_normal ipsSpacer_bottom\" data-role=\"filterBlurb\">\nCONTENT;\n$return .= htmlspecialchars( $stream->title, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n <a href=\"\nCONTENT;\n\n$return .= str_replace( '&', '&amp;', \\IPS\\Http\\Url::internal( \"app=nexus&module=support&controller=requests&do=filters\", null, \"\", array(), 0 ) );\n$return .= <<<CONTENT\n\" data-action=\"showFilterForm\" class=\"ipsType_small\">(\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'change', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n)<\/a><\/p>\n\t<\/noscript>\n\t<div class=\"ipsJS_show\" data-role=\"filterForm\">\n\t\t{$form}\n\t<\/div>\n\t<div data-role='mainTable' class='ipsPad' id='elRequestsTabContent'>\n\t\t\nCONTENT;\n\nif ( $stream->temporary ):\n$return .= <<<CONTENT\n\n\t\t\t<a class='ipsResponsive_showPhone ipsResponsive_block ipsButton ipsButton_veryVerySmall ipsButton_light ipsSpacer_half ipsButton_fullWidth ipsSpacer_bottom' href=\"\nCONTENT;\n\n$return .= str_replace( '&', '&amp;', \\IPS\\Http\\Url::internal( \"app=nexus&module=support&controller=requests&do=saveStream&id={$stream->id}\", null, \"\", array(), 0 ) );\n$return .= <<<CONTENT\n\" data-ipsMenu id=\"elSaveStream\">\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'save_this_stream', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a>\n\t\t\nCONTENT;\n\nelseif ( is_int( $stream->id ) ):\n$return .= <<<CONTENT\n\n\t\t\t<a class='ipsResponsive_showPhone ipsResponsive_block ipsButton ipsButton_veryVerySmall ipsButton_light ipsSpacer_half ipsButton_fullWidth ipsSpacer_bottom' href=\"\nCONTENT;\n\n$return .= str_replace( '&', '&amp;', \\IPS\\Http\\Url::internal( \"app=nexus&module=support&controller=requests&do=editStream&id={$stream->id}\", null, \"\", array(), 0 ) );\n$return .= <<<CONTENT\n\" data-action=\"editStream\">\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'edit_this_stream', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n <i class='fa fa-angle-down'><\/i><\/a>\n\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\nCONTENT;\n\n$return .= \\IPS\\Theme::i()->getTemplate( \"support\", \\IPS\\Request::i()->app )->requestsTable( $results, $pagination, $groupByDepartment, $sortBy, $sortDir, $tracked, $participatedIn, $honorSeverities );\n$return .= <<<CONTENT\n\n\t<\/div>\n<\/div>\nCONTENT;\n\n\t\treturn $return;\n}\n\n\tfunction requestsTable( $results, $pagination, $groupByDepartment, $sortBy, $sortDir, $tracked, $participatedIn, $honorSeverities=TRUE ) {\n\t\t$return = '';\n\t\t$return .= <<<CONTENT\n\n\n\n<div class=\"ipsButtonBar acpWidgetToolbar ipsClearfix ipsPad_half cNexusSupportTable_bar\">\n\t<ul class=\"ipsButtonRow ipsPos_right ipsClearfix\">\n\t\t<li>\n\t\t\t<a class=\"ipsJS_show\" href=\"#elCheck_menu\" id=\"elCheck\" title='\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'select_rows_tooltip', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n' data-ipsTooltip data-ipsAutoCheck data-ipsAutoCheck-context=\".cNexusSupportTable\" data-ipsMenu data-ipsMenu-activeClass=\"ipsButtonRow_active\">\n\t\t\t\t<span class=\"cAutoCheckIcon ipsType_medium\"><i class=\"fa fa-square-o\"><\/i><\/span> <i class=\"fa fa-caret-down\"><\/i>\n\t\t\t\t<span class='ipsNotificationCount' data-role='autoCheckCount'>0<\/span>\n\t\t\t<\/a>\n\t\t\t<ul class=\"ipsMenu ipsMenu_auto ipsMenu_withStem ipsHide\" id=\"elCheck_menu\">\n\t\t\t\t<li class=\"ipsMenu_title\">\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'select_rows', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/li>\n\t\t\t\t<li class=\"ipsMenu_item\" data-ipsMenuValue=\"all\"><a href=\"#\">\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'all', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a><\/li>\n\t\t\t\t<li class=\"ipsMenu_item\" data-ipsMenuValue=\"none\"><a href=\"#\">\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'none', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a><\/li>\n\t\t\t\t<li class=\"ipsMenu_sep\"><hr><\/li>\n\t\t\t\t<li class=\"ipsMenu_item\" data-ipsMenuValue=\"read\"><a href=\"#\">\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'read', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a><\/li>\n\t\t\t\t<li class=\"ipsMenu_item\" data-ipsMenuValue=\"unread\"><a href=\"#\">\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'unread', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a><\/li>\n\t\t\t\t<li class=\"ipsMenu_sep\"><hr><\/li>\n\t\t\t\t<li class=\"ipsMenu_item\" data-ipsMenuValue=\"tracking\"><a href=\"#\">\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'tracking', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a><\/li>\n\t\t\t\t<li class=\"ipsMenu_item\" data-ipsMenuValue=\"not_tracking\"><a href=\"#\">\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'not_tracking', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a><\/li>\n\t\t\t\t<li class=\"ipsMenu_sep\"><hr><\/li>\n\t\t\t\t\nCONTENT;\n\nforeach ( \\IPS\\nexus\\Support\\Status::roots() as $status ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t<li class=\"ipsMenu_item\" data-ipsMenuValue=\"status_\nCONTENT;\n$return .= htmlspecialchars( $status->id, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\"><a href=\"#\">\nCONTENT;\n$return .= htmlspecialchars( $status->_title, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n<\/a><\/li>\n\t\t\t\t\nCONTENT;\n\nendforeach;\n$return .= <<<CONTENT\n\n\t\t\t<\/ul>\n\t\t<\/li>\n\t<\/ul>\n\t<ul class=\"ipsButtonRow ipsPos_right ipsClearfix\">\n\t\t<li>\n\t\t\t<a href=\"#elSortMenu_menu\" id=\"elSortMenu\" data-ipsMenu data-ipsMenu-activeClass=\"ipsButtonRow_active\" data-ipsMenu=\"radio\" data-ipsMenu-stopLinks>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'sort_by', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n <i class=\"fa fa-caret-down\"><\/i><\/a>\n\t\t\t<ul class=\"ipsMenu ipsMenu_auto ipsMenu_withStem ipsMenu_selectable ipsHide\" id=\"elSortMenu_menu\">\n\t\t\t\t\nCONTENT;\n\nforeach ( array( 'r_started', 'r_last_new_reply', 'r_last_reply', 'r_last_staff_reply' ) as $k ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t<li class=\"ipsMenu_item \nCONTENT;\n\nif ( $sortBy == $k ):\n$return .= <<<CONTENT\nipsMenu_itemChecked\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\" data-ipsMenuValue=\"\nCONTENT;\n$return .= htmlspecialchars( $k, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\">\n\t\t\t\t\t\t<a href=\"\nCONTENT;\n\n$return .= str_replace( '&', '&amp;', \\IPS\\Http\\Url::internal( \"app=nexus&module=support&controller=requests&sortBy={$k}\", null, \"\", array(), 0 ) );\n$return .= <<<CONTENT\n\" data-group=\"sortBy\" data-action=\"reloadTable\">\nCONTENT;\n\n$val = \"{$k}\"; $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( $val, ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a>\n\t\t\t\t\t<\/li>\n\t\t\t\t\nCONTENT;\n\nendforeach;\n$return .= <<<CONTENT\n\n\t\t\t\t<li class=\"ipsMenu_sep\"><hr><\/li>\n\t\t\t\t<li class=\"ipsMenu_item \nCONTENT;\n\nif ( $honorSeverities ):\n$return .= <<<CONTENT\nipsMenu_itemChecked\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\" data-ipsMenuValue=\"1\">\n\t\t\t\t\t<a href=\"\nCONTENT;\n\n$return .= str_replace( '&', '&amp;', \\IPS\\Http\\Url::internal( \"app=nexus&module=support&controller=requests&honorSeverities=1\", null, \"\", array(), 0 ) );\n$return .= <<<CONTENT\n\" data-group=\"severitySort\" data-action=\"reloadTable\">\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'support_honor_severity_sort', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a>\n\t\t\t\t<\/li>\n\t\t\t\t<li class=\"ipsMenu_item \nCONTENT;\n\nif ( !$honorSeverities ):\n$return .= <<<CONTENT\nipsMenu_itemChecked\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\" data-ipsMenuValue=\"0\">\n\t\t\t\t\t<a href=\"\nCONTENT;\n\n$return .= str_replace( '&', '&amp;', \\IPS\\Http\\Url::internal( \"app=nexus&module=support&controller=requests&honorSeverities=0\", null, \"\", array(), 0 ) );\n$return .= <<<CONTENT\n\" data-group=\"severitySort\" data-action=\"reloadTable\">\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'support_no_honor_severity_sort', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a>\n\t\t\t\t<\/li>\n\t\t\t<\/ul>\n\t\t<\/li>\n\t\t<li>\n\t\t\t<a href=\"#elOrderMenu_menu\" id=\"elOrderMenu\" data-ipsMenu data-ipsMenu-activeClass=\"ipsButtonRow_active\" data-ipsMenu=\"radio\" data-ipsMenu-stopLinks>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'order_by', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n <i class=\"fa fa-caret-down\"><\/i><\/a>\n\t\t\t<ul class=\"ipsMenu ipsMenu_auto ipsMenu_withStem ipsMenu_selectable ipsHide\" id=\"elOrderMenu_menu\">\n\t\t\t\t<li class=\"ipsMenu_item \nCONTENT;\n\nif ( $sortDir == 'ASC' ):\n$return .= <<<CONTENT\nipsMenu_itemChecked\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\" data-ipsMenuValue=\"asc\">\n\t\t\t\t\t<a href=\"\nCONTENT;\n\n$return .= str_replace( '&', '&amp;', \\IPS\\Http\\Url::internal( \"app=nexus&module=support&controller=requests&sortDir=ASC\", null, \"\", array(), 0 ) );\n$return .= <<<CONTENT\n\">\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'support_oldest_first', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a>\n\t\t\t\t<\/li>\n\t\t\t\t<li class=\"ipsMenu_item \nCONTENT;\n\nif ( $sortDir == 'DESC' ):\n$return .= <<<CONTENT\nipsMenu_itemChecked\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\" data-ipsMenuValue=\"desc\">\n\t\t\t\t\t<a href=\"\nCONTENT;\n\n$return .= str_replace( '&', '&amp;', \\IPS\\Http\\Url::internal( \"app=nexus&module=support&controller=requests&sortDir=DESC\", null, \"\", array(), 0 ) );\n$return .= <<<CONTENT\n\">\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'support_newest_first', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a>\n\t\t\t\t<\/li>\n\t\t\t<\/ul>\n\t\t<\/li>\n\t<\/ul>\n\t<ul class=\"ipsButtonRow ipsPos_right ipsClearfix\">\n\t\t<li>\n\t\t\t\nCONTENT;\n\nif ( $groupByDepartment ):\n$return .= <<<CONTENT\n\n\t\t\t\t<a href=\"\nCONTENT;\n\n$return .= str_replace( '&', '&amp;', \\IPS\\Http\\Url::internal( \"app=nexus&module=support&controller=requests&groupByDepartment=0\", null, \"\", array(), 0 ) );\n$return .= <<<CONTENT\n\" class=\"ipsButtonRow_active\" data-action=\"reloadTable\">\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'group_by_department', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a>\n\t\t\t\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n\t\t\t\t<a href=\"\nCONTENT;\n\n$return .= str_replace( '&', '&amp;', \\IPS\\Http\\Url::internal( \"app=nexus&module=support&controller=requests&groupByDepartment=1\", null, \"\", array(), 0 ) );\n$return .= <<<CONTENT\n\" data-action=\"reloadTable\">\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'group_by_department', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a>\n\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t<\/li>\n\t<\/ul>\n\t{$pagination}\n<\/div>\n\n<div data-controller='nexus.admin.support.multimod'>\n\t<form action=\"\nCONTENT;\n\n$return .= str_replace( '&', '&amp;', \\IPS\\Http\\Url::internal( \"app=nexus&module=support&controller=requests&do=multimod\", null, \"\", array(), 0 ) );\n$return .= <<<CONTENT\n\" method=\"post\" data-ipsPageAction data-role='moderationTools'>\n\t\t<input type=\"hidden\" name=\"csrfKey\" value=\"\nCONTENT;\n\n$return .= htmlspecialchars( \\IPS\\Session::i()->csrfKey, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\">\n\t\t\nCONTENT;\n\n$return .= \\IPS\\Theme::i()->getTemplate( \"support\", \\IPS\\Request::i()->app )->requestsTableResults( $results, $pagination, $groupByDepartment, $tracked, $participatedIn );\n$return .= <<<CONTENT\n\n\t<\/form>\n<\/div>\nCONTENT;\n\n\t\treturn $return;\n}\n\n\tfunction requestsTableResults( $results, $pagination, $groupByDepartment, $tracked, $participatedIn, $full=TRUE ) {\n\t\t$return = '';\n\t\t$return .= <<<CONTENT\n\n\n\nCONTENT;\n\n$multimod = implode( ' ', array_merge( array_map( function( $department ) { return \"department_{$department->id}\"; }, \\IPS\\nexus\\Support\\Department::roots() ), array_map( function( $severity ) { return \"severity_{$severity->id}\"; }, \\IPS\\nexus\\Support\\Severity::roots() ), array_map( function( $status ) { return \"status_{$status->id}\"; }, \\IPS\\nexus\\Support\\Status::roots() ), array_map( function( $id ) { return \"staff_{$id}\"; }, array_keys( \\IPS\\nexus\\Support\\Request::staff() ) ), array( 'staff_0', 'delete' ) ) );\n$return .= <<<CONTENT\n\n\n\nCONTENT;\n\nif ( !count( $results ) ):\n$return .= <<<CONTENT\n\n\t\nCONTENT;\n\nif ( \\IPS\\Request::i()->module === 'customers' && \\IPS\\Request::i()->controller === 'view' ):\n$return .= <<<CONTENT\n\n\t\t<div class='ipsPad_half ipsType_light'>\n\t\t\t\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'no_support_requests', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\n\t\t<\/div>\n\t\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n\t\t<div class='ipsPad_double ipsType_center'>\n\t\t\t<span class='ipsBadge ipsBadge_style5 ipsBadge_veryLarge'>\n\t\t\t\t<i class='fa fa-thumbs-up'><\/i>\n\t\t\t<\/span>\n\n\t\t\t<p class='ipsType_reset ipsType_large ipsSpacer_top'>\n\t\t\t\t<strong>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'motivate_title', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/strong>\n\t\t\t<\/p>\n\t\t\t<p class='ipsType_reset ipsType_normal ipsType_light'>\n\t\t\t\t\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'motivate_desc', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\n\t\t\t<\/p>\n\t\t<\/div>\n\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n\t<table class=\"ipsTable cNexusSupportTable \nCONTENT;\n\nif ( !$full ):\n$return .= <<<CONTENT\ncNexusSupportTable_condensed\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\" data-role=\"resultsTable\">\n\t\t\nCONTENT;\n\nif ( $full ):\n$return .= <<<CONTENT\n\n\t\t\t<thead>\n\t\t\t\t<tr>\n\t\t\t\t\t<th class='ipsType_noBreak'>&nbsp;<\/th>\n\t\t\t\t\t<th class='ipsType_noBreak'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'request', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/th>\n\t\t\t\t\t<th class='ipsType_noBreak'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'r_status', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/th>\n\t\t\t\t\t<th class='ipsType_noBreak'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'r_staff', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/th>\n\t\t\t\t\t<th class='ipsType_noBreak'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'request_started_by', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/th>\n\t\t\t\t\t<th class='ipsType_noBreak'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'r_last_reply_by', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/th>\n\t\t\t\t\t<th class='ipsType_noBreak'>&nbsp;<\/th>\n\t\t\t\t\t<th class='ipsType_noBreak'>&nbsp;<\/th>\n\t\t\t\t<\/tr>\n\t\t\t<\/thead>\n\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t<tbody>\n\t\t\t\nCONTENT;\n\n$lastDepartment = NULL;\n$return .= <<<CONTENT\n\n\t\t\t\nCONTENT;\n\nforeach ( $results as $request ):\n$return .= <<<CONTENT\n\n\t\t\t\t\nCONTENT;\n\nif ( $groupByDepartment and $request->department->id != $lastDepartment ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td colspan=\"8\" class=\"ipsAreaBackground\">\n\t\t\t\t\t\t\t<strong>\nCONTENT;\n$return .= htmlspecialchars( $request->department->_title, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n<\/strong>\n\t\t\t\t\t\t<\/td>\n\t\t\t\t\t<\/tr>\n\t\t\t\t\t\nCONTENT;\n\n$lastDepartment = $request->department->id;\n$return .= <<<CONTENT\n\n\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\nCONTENT;\n\n$color = ( $request->severity and $request->severity->color != '000' ) ? $request->severity->color : FALSE;\n$return .= <<<CONTENT\n\n\t\t\t\t<tr class=\"ipsClearfix cNexusSupportTable_row\" \nCONTENT;\n\nif ( $color ):\n$return .= <<<CONTENT\nstyle='border-color: #\nCONTENT;\n$return .= htmlspecialchars( $color, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n; background: \nCONTENT;\n\n$return .= \\IPS\\Output\\Plugin\\Hextorgb::convertToRGB($color, 0.075);\n$return .= <<<CONTENT\n'\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n>\n\t\t\t\t\t<td class=\"ipsType_center cNexusSupportTable_icon \nCONTENT;\n\nif ( !$groupByDepartment ):\n$return .= <<<CONTENT\nipsPos_top\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\">\n\t\t\t\t\t\t\nCONTENT;\n\nif ( $request->unread() ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t<a href=\"\nCONTENT;\n$return .= htmlspecialchars( $request->acpUrl()->setQueryString( 'do', 'getNewComment' ), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\" title=\"\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'support_go_to_unread', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\" data-ipsTooltip>\n\t\t\t\t\t\t\t\t<span class='ipsItemStatus'>\n\t\t\t\t\t\t\t\t\t<i class=\"fa \nCONTENT;\n\nif ( array_key_exists( $request->id, $tracked ) ):\n$return .= <<<CONTENT\nfa-bookmark\nCONTENT;\n\nelseif ( in_array( $request->id, $participatedIn ) ):\n$return .= <<<CONTENT\nfa-star\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\nfa-circle\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\"><\/i>\n\t\t\t\t\t\t\t\t<\/span>\n\t\t\t\t\t\t\t<\/a>\n\t\t\t\t\t\t\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\nCONTENT;\n\nif ( array_key_exists( $request->id, $tracked ) ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t<span class='ipsItemStatus ipsItemStatus_read ipsItemStatus_posted'>\n\t\t\t\t\t\t\t\t\t<i class=\"fa fa-bookmark\"><\/i>\n\t\t\t\t\t\t\t\t<\/span>\n\t\t\t\t\t\t\t\nCONTENT;\n\nelseif ( in_array( $request->id, $participatedIn ) ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t<span class='ipsItemStatus ipsItemStatus_read ipsItemStatus_posted'>\n\t\t\t\t\t\t\t\t\t<i class=\"fa fa-star\"><\/i>\n\t\t\t\t\t\t\t\t<\/span>\n\t\t\t\t\t\t\t\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t&nbsp;\n\t\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t<\/td>\n\t\t\t\t\t<td class=\"cNexusSupportTable_body ipsTable_wrap \nCONTENT;\n\nif ( !$groupByDepartment ):\n$return .= <<<CONTENT\nipsPos_top\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\">\n\t\t\t\t\t\t\nCONTENT;\n\nif ( $color ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\nCONTENT;\n\n$return .= \\IPS\\Theme::i()->getTemplate( \"support\", \"nexus\" )->severity( $request->severity );\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t<span class='ipsType_normal ipsType_blendLinks'>\n\t\t\t\t\t\t\t\nCONTENT;\n\n$return .= \\IPS\\Theme::i()->getTemplate( \"support\", \"nexus\" )->link( $request, TRUE );\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t<\/span>\n\t\t\t\t\t\t\nCONTENT;\n\nif ( !$groupByDepartment and $full ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t<p class='ipsType_medium ipsType_reset ipsResponsive_hidePhone'>\n\t\t\t\t\t\t\t\t<span class=\"ipsType_light\">\nCONTENT;\n\n$sprintf = array($request->department->_title); $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'in_department', ENT_DISALLOWED, 'UTF-8', FALSE ), FALSE, array( 'sprintf' => $sprintf ) );\n$return .= <<<CONTENT\n<\/span>\n\t\t\t\t\t\t\t<\/p>\n\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t<div class=\"\nCONTENT;\n\nif ( $full ):\n$return .= <<<CONTENT\nipsResponsive_showPhone ipsResponsive_hideDesktop ipsResponsive_hideTablet\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\">\n\t\t\t\t\t\t\t<p class=\"ipsType_medium ipsType_reset\">\n\t\t\t\t\t\t\t\t\nCONTENT;\n\nif ( !$groupByDepartment ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\nCONTENT;\n\n$sprintf = array($request->department->_title); $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'in_department', ENT_DISALLOWED, 'UTF-8', FALSE ), FALSE, array( 'sprintf' => $sprintf ) );\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\nCONTENT;\n\nif ( $request->staff ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nif ( !$groupByDepartment ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t&nbsp;\n\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t<strong class=\"ipsType_success\">\n\t\t\t\t\t\t\t\t\t\t\nCONTENT;\n\n$sprintf = array($request->staff->name); $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'assigned_to_x', ENT_DISALLOWED, 'UTF-8', FALSE ), FALSE, array( 'sprintf' => $sprintf ) );\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t<\/strong>\n\t\t\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t<\/p>\n\t\t\t\t\t\t\t<p class=\"ipsType_medium ipsType_reset ipsType_light ipsType_blendLinks\">\n\t\t\t\t\t\t\t\t\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'request_last_by', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n \nCONTENT;\n\n$return .= \\IPS\\Theme::i()->getTemplate( \"global\", \"nexus\" )->userLink( \\IPS\\Member::load( $request->last_reply_by ) );\n$return .= <<<CONTENT\n \nCONTENT;\n\n$val = ( $request->last_reply instanceof \\IPS\\DateTime ) ? $request->last_reply : \\IPS\\DateTime::ts( $request->last_reply );$return .= $val->html();\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t<\/p>\n\t\t\t\t\t\t<\/div>\n\t\t\t\t\t<\/td>\n\t\t\t\t\t<td class=\"cNexusSupportTable_status\">\n\t\t\t\t\t\t\nCONTENT;\n\n$return .= \\IPS\\Theme::i()->getTemplate( \"support\", \"nexus\" )->status( $request->status );\n$return .= <<<CONTENT\n\n\t\t\t\t\t<\/td>\n\t\t\t\t\t<td class=\"cNexusSupportTable_assignedTo\">\n\t\t\t\t\t\t\nCONTENT;\n\nif ( $request->staff ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t<strong class=\"ipsType_success\">\n\t\t\t\t\t\t\t\t\nCONTENT;\n$return .= htmlspecialchars( $request->staff->name, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t<\/strong>\n\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t<\/td>\n\t\t\t\t\t<td class=\"cNexusSupportTable_customer ipsType_blendLinks\">\n\t\t\t\t\t\t\nCONTENT;\n\nif ( $request->author()->member_id ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\nCONTENT;\n\n$return .= \\IPS\\Theme::i()->getTemplate( \"global\", \"nexus\" )->userLink( $request->author() );\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\nCONTENT;\n$return .= htmlspecialchars( $request->email, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t<p class='ipsType_reset ipsType_light ipsType_medium'>\nCONTENT;\n\n$val = ( $request->started instanceof \\IPS\\DateTime ) ? $request->started : \\IPS\\DateTime::ts( $request->started );$return .= $val->html();\n$return .= <<<CONTENT\n<\/p>\n\t\t\t\t\t<\/td>\n\t\t\t\t\t<td class=\"cNexusSupportTable_customer ipsType_blendLinks\">\n\t\t\t\t\t\t\nCONTENT;\n\n$return .= \\IPS\\Theme::i()->getTemplate( \"global\", \"nexus\" )->userLink( \\IPS\\Member::load( $request->last_reply_by ) );\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t<p class='ipsType_reset ipsType_light ipsType_medium'>\nCONTENT;\n\n$val = ( $request->last_reply instanceof \\IPS\\DateTime ) ? $request->last_reply : \\IPS\\DateTime::ts( $request->last_reply );$return .= $val->html();\n$return .= <<<CONTENT\n<\/p>\n\t\t\t\t\t<\/td>\n\t\t\t\t\t<td class='cNexusSupportTable_replies'>\n\t\t\t\t\t\t<span class='ipsCommentCount'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->formatNumber( $request->replies - 1 );\n$return .= <<<CONTENT\n<\/span>\n\t\t\t\t\t<\/td>\n\t\t\t\t\t\nCONTENT;\n\nif ( $full ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t<td class='cNexusSupportTable_multimod'>\n\t\t\t\t\t\t\t<span class='ipsCustomInput'>\n\t\t\t\t\t\t\t\t<input type=\"checkbox\" name=\"multimod[\nCONTENT;\n$return .= htmlspecialchars( $request->id, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n]\" value=\"1\" data-role=\"moderation\" data-actions=\"\nCONTENT;\n$return .= htmlspecialchars( $multimod, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n \nCONTENT;\n\nif ( array_key_exists( $request->id, $tracked ) ):\n$return .= <<<CONTENT\n\nCONTENT;\n\nif ( $tracked[ $request->id ] ):\n$return .= <<<CONTENT\ntrack_on\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\ntrack_notify\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n track_off\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\ntrack_on track_notify\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\" data-state=\"\nCONTENT;\n\nif ( $request->unread() ):\n$return .= <<<CONTENT\nunread\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\nread\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n \nCONTENT;\n\nif ( array_key_exists( $request->id, $tracked ) ):\n$return .= <<<CONTENT\ntracking\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\nnot_tracking\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n status_\nCONTENT;\n$return .= htmlspecialchars( $request->status->id, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\">\n\t\t\t\t\t\t\t\t<span><\/span>\n\t\t\t\t\t\t\t<\/span>\n\t\t\t\t\t\t<\/td>\n\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t<\/tr>\n\t\t\t\nCONTENT;\n\nendforeach;\n$return .= <<<CONTENT\n\n\t\t<\/tbody>\n\t\t\nCONTENT;\n\nif ( $full ):\n$return .= <<<CONTENT\n\n\t\t\t<tfoot class=\"ipsClearfix ipsAreaBackground ipsJS_hide\" data-role=\"pageActionOptions\">\n\t\t\t\t<tr>\n\t\t\t\t\t<td colspan=\"8\">\n\t\t\t\t\t\t<div class=\"ipsPos_right\">\n\t\t\t\t\t\t\t<select name=\"modaction\" data-role=\"moderationAction\">\n\t\t\t\t\t\t\t\t<optgroup label=\"\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'action_status', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\" data-icon='tag' data-action='status'>\n\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nforeach ( \\IPS\\nexus\\Support\\Status::roots() as $status ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t<option value='status_\nCONTENT;\n$return .= htmlspecialchars( $status->id, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n'>\nCONTENT;\n$return .= htmlspecialchars( $status->_title, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n<\/option>\n\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nendforeach;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t<\/optgroup>\n\t\t\t\t\t\t\t\t\nCONTENT;\n\nif ( count( \\IPS\\nexus\\Support\\Severity::roots() ) > 1 ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t<optgroup label=\"\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'action_severity', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\" data-icon='exclamation' data-action='severity'>\n\t\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nforeach ( \\IPS\\nexus\\Support\\Severity::roots() as $severity ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t\t<option value='severity_\nCONTENT;\n$return .= htmlspecialchars( $severity->id, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n'>\nCONTENT;\n$return .= htmlspecialchars( $severity->_title, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n<\/option>\n\t\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nendforeach;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t<\/optgroup>\n\t\t\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t<optgroup label=\"\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'action_department', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\" data-icon='folder' data-action='department'>\n\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nforeach ( \\IPS\\nexus\\Support\\Department::roots() as $department ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t<option value='department_\nCONTENT;\n$return .= htmlspecialchars( $department->id, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n'>\nCONTENT;\n$return .= htmlspecialchars( $department->_title, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n<\/option>\n\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nendforeach;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t<\/optgroup>\n\t\t\t\t\t\t\t\t<optgroup label=\"\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'action_staff', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\" data-icon='user' data-action='staff'>\n\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nforeach ( \\IPS\\nexus\\Support\\Request::staff() as $id => $name ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t<option value='staff_\nCONTENT;\n$return .= htmlspecialchars( $id, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n'>\nCONTENT;\n$return .= htmlspecialchars( $name, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n<\/option>\n\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nendforeach;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t<option value='staff_0'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'unassigned', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/option>\n\t\t\t\t\t\t\t\t<\/optgroup>\n\t\t\t\t\t\t\t\t<optgroup label=\"\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'tracking', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\" data-icon='bookmark' data-action='tracking'>\n\t\t\t\t\t\t\t\t\t<option value='track_off'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'not_tracking', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/option>\n\t\t\t\t\t\t\t\t\t<option value='track_on'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'tracking_no_notify', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/option>\n\t\t\t\t\t\t\t\t\t<option value='track_notify'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'tracking_notify', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/option>\n\t\t\t\t\t\t\t\t<\/optgroup>\n\t\t\t\t\t\t\t\t\nCONTENT;\n\nif ( \\IPS\\Member::loggedIn()->hasAcpRestriction( 'nexus', 'support', 'requests_delete' ) ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t<option value=\"delete\" data-icon=\"trash\">\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'delete', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/option>\n\t\t\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t<\/select>\n\t\t\t\t\t\t\t<button type=\"submit\" class=\"ipsButton ipsButton_alternate ipsButton_verySmall\">\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'submit', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/button>\n\t\t\t\t\t\t<\/div>\n\t\t\t\t\t<\/td>\n\t\t\t\t<\/tr>\n\t\t\t<\/tfoot>\n\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t<\/table>\n\t{$pagination}\n\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\nCONTENT;\n\n\t\treturn $return;\n}\n\n\tfunction severities( $table ) {\n\t\t$return = '';\n\t\t$return .= <<<CONTENT\n\n<div class=\"ipsPad ipsType_normal ipsSpacer_bottom ipsAreaBackground_light\">\n\t\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'severities_desc', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\n\t<br><br>\n\t<div class=\"ipsClearfix\">\n\t\t<div class=\"ipsPos_left\">\n\t\t\t<strong>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'nexus_severities', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/strong><br>\n\t\t\t<span class=\"ipsType_light ipsType_small\">\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'nexus_severities_desc', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/span>\n\t\t<\/div>\n\t\t<div class=\"ipsPos_left ipsPad_half\">\n\t\t\t\nCONTENT;\n\nif ( \\IPS\\Settings::i()->nexus_severities ):\n$return .= <<<CONTENT\n\n\t\t\t\t<a href=\"\nCONTENT;\n\n$return .= str_replace( '&', '&amp;', \\IPS\\Http\\Url::internal( \"app=nexus&module=support&controller=settings&tab=severities&nexus_severities=0\", null, \"\", array(), 0 ) );\n$return .= <<<CONTENT\n\"><span class=\"ipsToggle ipsToggle_on\" id=\"check_sev_public_wrapper\" tabindex=\"0\"><span data-role=\"status\">\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'on', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/span><\/span><\/a>\n\t\t\t\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n\t\t\t\t<a href=\"\nCONTENT;\n\n$return .= str_replace( '&', '&amp;', \\IPS\\Http\\Url::internal( \"app=nexus&module=support&controller=settings&tab=severities&nexus_severities=1\", null, \"\", array(), 0 ) );\n$return .= <<<CONTENT\n\"><span class=\"ipsToggle ipsToggle_off\" id=\"check_sev_public_wrapper\" tabindex=\"0\"><span data-role=\"status\">\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'off', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/span><\/span><\/a>\n\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t<\/div>\n\t<\/div>\n<\/div>\n{$table}\nCONTENT;\n\n\t\treturn $return;\n}\n\n\tfunction severity( $severity ) {\n\t\t$return = '';\n\t\t$return .= <<<CONTENT\n\n<span class=\"cNexusSupportBadge ipsTruncate ipsTruncate_line\" style=\"background-color: #\nCONTENT;\n$return .= htmlspecialchars( $severity->color, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\" data-ipsTooltip data-ipsTooltip-label=\"\nCONTENT;\n$return .= htmlspecialchars( $severity->_title, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\">\nCONTENT;\n$return .= htmlspecialchars( $severity->_title, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n<\/span>\nCONTENT;\n\n\t\treturn $return;\n}\n\n\tfunction staffReply(  ) {\n\t\t$return = '';\n\t\t$return .= <<<CONTENT\n\n\nCONTENT;\n\n\t\treturn $return;\n}\n\n\tfunction staffReplyForm( $request, $id, $action, $elements, $hiddenValues, $actionButtons, $uploadField, $class='', $attributes=array(), $sidebar, $form=NULL ) {\n\t\t$return = '';\n\t\t$return .= <<<CONTENT\n\n\n<form accept-charset='utf-8' class=\"cNexusSupportForm ipsForm \nCONTENT;\n$return .= htmlspecialchars( $class, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\" action=\"\nCONTENT;\n$return .= htmlspecialchars( $action, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\" method=\"post\" \nCONTENT;\n\nif ( $uploadField ):\n$return .= <<<CONTENT\nenctype=\"multipart\/form-data\"\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n \nCONTENT;\n\nforeach ( $attributes as $k => $v ):\n$return .= <<<CONTENT\n\nCONTENT;\n$return .= htmlspecialchars( $k, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n=\"\nCONTENT;\n$return .= htmlspecialchars( $v, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\"\nCONTENT;\n\nendforeach;\n$return .= <<<CONTENT\n data-ipsForm id='elSupportReplyForm'>\n\t<input type=\"hidden\" name=\"\nCONTENT;\n$return .= htmlspecialchars( $id, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n_submitted\" value=\"1\">\n\t\nCONTENT;\n\nforeach ( $hiddenValues as $k => $v ):\n$return .= <<<CONTENT\n\n\t\t\nCONTENT;\n\nif ( is_array($v) ):\n$return .= <<<CONTENT\n\n\t\t\t\nCONTENT;\n\nforeach ( $v as $_k => $_v ):\n$return .= <<<CONTENT\n\n\t\t\t\t<input type=\"hidden\" name=\"\nCONTENT;\n$return .= htmlspecialchars( $k, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n[\nCONTENT;\n$return .= htmlspecialchars( $_k, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n]\" value=\"\nCONTENT;\n$return .= htmlspecialchars( $_v, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\">\n\t\t\t\nCONTENT;\n\nendforeach;\n$return .= <<<CONTENT\n\n\t\t\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n\t\t\t<input type=\"hidden\" name=\"\nCONTENT;\n$return .= htmlspecialchars( $k, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\" value=\"\nCONTENT;\n$return .= htmlspecialchars( $v, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\">\n\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\nCONTENT;\n\nendforeach;\n$return .= <<<CONTENT\n\n\t\nCONTENT;\n\nif ( $uploadField ):\n$return .= <<<CONTENT\n\n\t\t<input type=\"hidden\" name=\"MAX_FILE_SIZE\" value=\"\nCONTENT;\n$return .= htmlspecialchars( $uploadField, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\">\n\t\t<input type=\"hidden\" name=\"plupload\" value=\"\nCONTENT;\n\n$return .= htmlspecialchars( md5( mt_rand() ), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\">\n\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\n\t<div class='ipsComposeArea'>\n\t\t\t\t\t\t\n\t\t<div class='ipsPad_half cNexusSupportForm_sendTo ipsJS_hide ipsClearfix' data-ipsEditor-toolList>\n\t\t\t\nCONTENT;\n\nif ( isset( $elements['']['stock_action'] ) ):\n$return .= <<<CONTENT\n\n\t\t\t\t<span class='ipsPos_right ipsResponsive_noFloat cNexusSupportForm_customAction'><i class='fa fa-flash ipsType_large ipsPos_middle' title='\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'stock_actions', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n' data-ipsTooltip><\/i> {$elements['']['stock_action']->html()}<\/span>\n\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t<div data-role='sendToInfo'>\n\t\t\t\t<p class='ipsType_reset ipsType_normal cNexusSupportForm_to'>\n\t\t\t\t\t<strong>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'to', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n:<\/strong> \nCONTENT;\n$return .= htmlspecialchars( $elements['']['to']->value, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n  &nbsp;&nbsp;<a href='#' class='ipsType_small' data-action='showCCForm'>(\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'edit_cc_bcc', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n)<\/a>\t\t\t\n\t\t\t\t<\/p>\n\t\t\t\t\nCONTENT;\n\nif ( count( $elements['']['cc']->value ) ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t<p class='ipsType_reset ipsType_light'>\n\t\t\t\t\t\t<strong>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'cc', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n:<\/strong> \nCONTENT;\n\n$return .= htmlspecialchars( implode(', ', $elements['']['cc']->value ), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\n\t\t\t\t\t<\/p>\n\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\nCONTENT;\n\nif ( count( $elements['']['bcc']->value ) ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t<p class='ipsType_reset ipsType_light'>\n\t\t\t\t\t\t<strong>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'bcc', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n:<\/strong> \nCONTENT;\n\n$return .= htmlspecialchars( implode(', ', $elements['']['bcc']->value ), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\n\t\t\t\t\t<\/p>\n\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t<\/div>\n\t\t\t<ul class='ipsForm ipsForm_horizontal ipsJS_hide' data-role='sendToForm'>\n\t\t\t\t\nCONTENT;\n\nif ( $elements['']['to'] ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t{$elements['']['to']->rowHtml($form)}\n\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\nCONTENT;\n\nif ( $elements['']['cc'] ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t{$elements['']['cc']->rowHtml($form)}\n\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\nCONTENT;\n\nif ( $elements['']['bcc'] ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t{$elements['']['bcc']->rowHtml($form)}\n\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t<\/ul>\n\t\t<\/div>\n\n\t\t<div>\n\t\t\t\nCONTENT;\n\nif ( $elements['']['message'] ):\n$return .= <<<CONTENT\n\n\t\t\t\t<div class='cNexusSupportForm_message'>\n\t\t\t\t\t{$elements['']['message']->html()}\n\t\t\t\t<\/div>\n\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t<\/div>\n\t\t\n\t\t<div class='ipsAreaBackground ipsClearfix ipsPad_half ipsType_right ipsJS_hide' data-ipsEditor-toolList>\n\t\t\t<ul class='ipsList_inline ipsPos_left ipsType_left cNexusSupportForm_controls'>\n\t\t\t\t\nCONTENT;\n\nif ( isset( $elements['']['status'] ) ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t<li>\n\t\t\t\t\t\t<h3 class='ipsType_minorHeading'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'status', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/h3>\n\t\t\t\t\t\t{$elements['']['status']->html()}\n\t\t\t\t\t<\/li>\n\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\nCONTENT;\n\nif ( isset( $elements['']['department'] ) ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t<li>\n\t\t\t\t\t\t<h3 class='ipsType_minorHeading'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'department', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/h3>\n\t\t\t\t\t\t{$elements['']['department']->html()}\n\t\t\t\t\t<\/li>\n\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\nCONTENT;\n\nif ( isset( $elements['']['assign_to'] ) ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t<li>\n\t\t\t\t\t\t<h3 class='ipsType_minorHeading'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'assign_to', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/h3>\n\t\t\t\t\t\t{$elements['']['assign_to']->html()}\n\t\t\t\t\t<\/li>\n\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t<\/ul>\n\t\t\t\nCONTENT;\n\n$next = $request->nextPrevious();\n$return .= <<<CONTENT\n\n\t\t\t\nCONTENT;\n\n$defaultAction = \\IPS\\nexus\\modules\\admin\\support\\request::defaultReplyAction();\n$return .= <<<CONTENT\n\n\t\t\t<ul class='ipsButton_split ipsType_noBreak ipsPos_right cNexusSupportForm_buttons'>\n\t\t\t\t\nCONTENT;\n\nif ( $defaultAction == 'stay' ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t<li><button type='submit' class='ipsButton ipsButton_primary ipsButton_large' data-role='primarySubmit'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'reply_and_stay', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/button><\/li>\n\t\t\t\t\t<li>\n\t\t\t\t\t\t<a href='#' class='ipsButton ipsButton_primary ipsButton_large ipsButton_narrow' id='elSupportReplyForm_more' data-ipsMenu data-ipsMenu-appendTo='#elSupportReplyForm'><i class='fa fa-caret-down'><\/i><\/a>\n\t\t\t\t\t\t<ul id='elSupportReplyForm_more_menu' class='ipsMenu ipsMenu_narrow ipsHide'>\n\t\t\t\t\t\t\t<li class='ipsMenu_item ipsPad_half'><button type='submit' class='ipsButton ipsButton_primary ipsButton_small ipsButton_fullWidth' name='goto' value='next'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'reply_and_go_to_next', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/button><\/li>\n\t\t\t\t\t\t\t<li class='ipsMenu_item ipsPad_half'><button type='submit' class='ipsButton ipsButton_primary ipsButton_small ipsButton_fullWidth' name='goto' value='first'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'reply_and_go_to_first', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/button><\/li>\n\t\t\t\t\t\t\t<li class='ipsMenu_item ipsPad_half'><button type='submit' class='ipsButton ipsButton_primary ipsButton_small ipsButton_fullWidth' name='goto' value='list'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'reply_and_go_to_list', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/button><\/li>\n\t\t\t\t\t\t<\/ul>\n\t\t\t\t\t<\/li>\n\t\t\t\t\nCONTENT;\n\nelseif ( $defaultAction == 'list' ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t<li><button type='submit' class='ipsButton ipsButton_primary ipsButton_large' data-role='primarySubmit' name='goto' value='list'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'reply_and_go_to_list', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/button><\/li>\n\t\t\t\t\t<li>\n\t\t\t\t\t\t<a href='#' class='ipsButton ipsButton_primary ipsButton_large ipsButton_narrow' id='elSupportReplyForm_more' data-ipsMenu data-ipsMenu-appendTo='#elSupportReplyForm'><i class='fa fa-caret-down'><\/i><\/a>\n\t\t\t\t\t\t<ul id='elSupportReplyForm_more_menu' class='ipsMenu ipsMenu_narrow ipsHide'>\n\t\t\t\t\t\t\t<li class='ipsMenu_item ipsPad_half'><button type='submit' class='ipsButton ipsButton_primary ipsButton_small ipsButton_fullWidth'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'reply_and_stay', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/button><\/li>\n\t\t\t\t\t\t\t<li class='ipsMenu_item ipsPad_half'><button type='submit' class='ipsButton ipsButton_primary ipsButton_small ipsButton_fullWidth' name='goto' value='next'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'reply_and_go_to_next', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/button><\/li>\n\t\t\t\t\t\t\t<li class='ipsMenu_item ipsPad_half'><button type='submit' class='ipsButton ipsButton_primary ipsButton_small ipsButton_fullWidth' name='goto' value='first'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'reply_and_go_to_first', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/button><\/li>\n\t\t\t\t\t\t<\/ul>\n\t\t\t\t\t<\/li>\n\t\t\t\t\nCONTENT;\n\nelseif ( $defaultAction == 'next' ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t<li><button type='submit' class='ipsButton ipsButton_primary ipsButton_large' data-role='primarySubmit' name='goto' value='next'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'reply_and_go_to_next', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/button><\/li>\n\t\t\t\t\t<li>\n\t\t\t\t\t\t<a href='#' class='ipsButton ipsButton_primary ipsButton_large ipsButton_narrow' id='elSupportReplyForm_more' data-ipsMenu data-ipsMenu-appendTo='#elSupportReplyForm'><i class='fa fa-caret-down'><\/i><\/a>\n\t\t\t\t\t\t<ul id='elSupportReplyForm_more_menu' class='ipsMenu ipsMenu_narrow ipsHide'>\n\t\t\t\t\t\t\t<li class='ipsMenu_item ipsPad_half'><button type='submit' class='ipsButton ipsButton_primary ipsButton_small ipsButton_fullWidth' name='goto' value='first'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'reply_and_go_to_first', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/button><\/li>\n\t\t\t\t\t\t\t<li class='ipsMenu_item ipsPad_half'><button type='submit' class='ipsButton ipsButton_primary ipsButton_small ipsButton_fullWidth'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'reply_and_stay', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/button><\/li>\n\t\t\t\t\t\t\t<li class='ipsMenu_item ipsPad_half'><button type='submit' class='ipsButton ipsButton_primary ipsButton_small ipsButton_fullWidth' name='goto' value='list'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'reply_and_go_to_list', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/button><\/li>\n\t\t\t\t\t\t<\/ul>\n\t\t\t\t\t<\/li>\n\t\t\t\t\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n\t\t\t\t\t<li><button type='submit' class='ipsButton ipsButton_primary ipsButton_large' data-role='primarySubmit' name='goto' value='first'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'reply_and_go_to_first', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/button><\/li>\n\t\t\t\t\t<li>\n\t\t\t\t\t\t<a href='#' class='ipsButton ipsButton_primary ipsButton_large ipsButton_narrow' id='elSupportReplyForm_more' data-ipsMenu data-ipsMenu-appendTo='#elSupportReplyForm'><i class='fa fa-caret-down'><\/i><\/a>\n\t\t\t\t\t\t<ul id='elSupportReplyForm_more_menu' class='ipsMenu ipsMenu_narrow ipsHide'>\n\t\t\t\t\t\t\t<li class='ipsMenu_item ipsPad_half'><button type='submit' class='ipsButton ipsButton_primary ipsButton_small ipsButton_fullWidth'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'reply_and_stay', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/button><\/li>\n\t\t\t\t\t\t\t<li class='ipsMenu_item ipsPad_half'><button type='submit' class='ipsButton ipsButton_primary ipsButton_small ipsButton_fullWidth' name='goto' value='next'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'reply_and_go_to_next', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/button><\/li>\n\t\t\t\t\t\t\t<li class='ipsMenu_item ipsPad_half'><button type='submit' class='ipsButton ipsButton_primary ipsButton_small ipsButton_fullWidth' name='goto' value='list'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'reply_and_go_to_list', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/button><\/li>\n\t\t\t\t\t\t<\/ul>\n\t\t\t\t\t<\/li>\n\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t<\/ul>\n\t\t<\/div>\n\t<\/div>\n<\/form>\nCONTENT;\n\n\t\treturn $return;\n}\n\n\tfunction status( $status, $classes='' ) {\n\t\t$return = '';\n\t\t$return .= <<<CONTENT\n\n<span class='cNexusSupportBadge ipsTruncate ipsTruncate_line \nCONTENT;\n\nif ( $classes ):\n$return .= <<<CONTENT\n\nCONTENT;\n$return .= htmlspecialchars( $classes, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n' \nCONTENT;\n\nif ( $status->color ):\n$return .= <<<CONTENT\nstyle=\"background-color: #\nCONTENT;\n$return .= htmlspecialchars( $status->color, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\"\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n title=\"\nCONTENT;\n$return .= htmlspecialchars( $status->_title, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\" data-ipsTooltip data-ipsTooltip-label=\"\nCONTENT;\n$return .= htmlspecialchars( $status->_title, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\">\nCONTENT;\n$return .= htmlspecialchars( $status->_title, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n<\/span>\nCONTENT;\n\n\t\treturn $return;\n}}"
VALUE;
